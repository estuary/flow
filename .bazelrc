# Auto-detect our platform and apply platform-specific configuration.
build --enable_platform_specific_config

# Prefix of directories holding bazel outputs
build --symlink_prefix=bazel- # Default

# Options are `fastbuild`, `dbg` (adds debug symbols), and `opt`.
# You can pass `-c dbg` or `-c opt` on the command line to override this.
build --compilation_mode=fastbuild # Default.

build --verbose_failures

# Platform-specific settings.
# host_cxxopt is for tools built by bazel that run on the host machine,
# while cxxopt is for code being built for the target platform.
build:linux --cxxopt=-std=c++20
build:linux --host_cxxopt=-std=c++20

build:macos --cxxopt=-std=c++20
build:macos --host_cxxopt=-std=c++20

# Rust-specific settings
# build --@rules_rust//:rustfmt.toml=//:rustfmt.toml  # Uncomment if rustfmt.toml is added

test --test_output=errors
test --test_summary=short

# Remote cache (disabled by default, can be enabled for CI)
# build --remote_cache=grpc://localhost:9092

# Disable hermetic action environment.
# We rely on env variables passed from the nix developer shell.
build --incompatible_strict_action_env=false

# C/C++ compiler from nix
build --action_env=CC
build --action_env=CXX
build --action_env=CPLUS_INCLUDE_PATH
build --action_env=NIX_LDFLAGS
build --action_env=LIBRARY_PATH
build --host_action_env=CC
build --host_action_env=CXX
build --host_action_env=CPLUS_INCLUDE_PATH
build --host_action_env=NIX_LDFLAGS
build --host_action_env=LIBRARY_PATH

# libclang for bindgen
build --action_env=LIBCLANG_PATH
build --host_action_env=LIBCLANG_PATH

# pkg-config for Rust build scripts
build --action_env=PKG_CONFIG_PATH
build --host_action_env=PKG_CONFIG_PATH

build --action_env=ROCKSDB_INCLUDE_DIR
build --action_env=ROCKSDB_LIB_DIR
build --action_env=ROCKSDB_STATIC
#build --host_action_env=ROCKSDB_INCLUDE_DIR
#build --host_action_env=ROCKSDB_LIB_DIR
#build --host_action_env=ROCKSDB_STATIC

build --action_env=OPENSSL_INCLUDE_DIR
build --action_env=OPENSSL_LIB_DIR
build --host_action_env=OPENSSL_INCLUDE_DIR
build --host_action_env=OPENSSL_LIB_DIR

build --action_env=JEMALLOC_OVERRIDE
build --host_action_env=JEMALLOC_OVERRIDE

# Import Nix-generated configuration (libc++ paths)
# This file is auto-generated by flake.nix shellHook
try-import %workspace%/.bazelrc.local
