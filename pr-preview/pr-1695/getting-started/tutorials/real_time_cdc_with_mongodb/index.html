<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-getting-started/tutorials/real_time_cdc_with_mongodb" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Real-time CDC with MongoDB | Estuary Flow Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.estuary.dev/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Real-time CDC with MongoDB | Estuary Flow Documentation"><meta data-rh="true" name="description" content="A step-by-step guide to setting up Change Data Capture (CDC) from MongoDB with Estuary Flow."><meta data-rh="true" property="og:description" content="A step-by-step guide to setting up Change Data Capture (CDC) from MongoDB with Estuary Flow."><meta data-rh="true" property="og:image" content="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image4_5c651b17d6/image4_5c651b17d6.png"><link data-rh="true" rel="icon" href="/pr-preview/pr-1695/img/favicon-2.ico"><link data-rh="true" rel="canonical" href="https://docs.estuary.dev/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/"><link data-rh="true" rel="alternate" href="https://docs.estuary.dev/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.estuary.dev/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/" hreflang="x-default"><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-WK8SB2L",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script><link rel="stylesheet" href="/pr-preview/pr-1695/assets/css/styles.7552b07e.css">
<script src="/pr-preview/pr-1695/assets/js/runtime~main.cd4195b6.js" defer="defer"></script>
<script src="/pr-preview/pr-1695/assets/js/main.8382dd8b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>


<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WK8SB2L" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/pr-preview/pr-1695/"><div class="navbar__logo"><img src="/pr-preview/pr-1695/img/estuary-new.png" alt="Estuary Flow Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/pr-preview/pr-1695/img/estuary-new.png" alt="Estuary Flow Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Estuary Flow</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pr-preview/pr-1695/">Documentation</a><div class="navbar__item"><a href="https://estuary.dev/blog/data-engineering/">Blog</a></div><div class="navbar__item button-link"><a href="https://dashboard.estuary.dev/register">Try Estuary</a></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/estuary/flow" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-preview/pr-1695/">Overview</a><button aria-label="Expand sidebar category &#x27;Overview&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/pr-preview/pr-1695/getting-started/installation/">Get started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/pr-1695/getting-started/installation/">Registration and setup</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/pr-preview/pr-1695/getting-started/tutorials/">Tutorials</a><button aria-label="Collapse sidebar category &#x27;Tutorials&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/pr-1695/getting-started/tutorials/postgresql_cdc_to_snowflake/">PostgreSQL CDC streaming to Snowflake</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/">Real-time CDC with MongoDB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/pr-1695/getting-started/tutorials/dataflow-s3-snowflake/">Create your first dataflow with Amazon S3 and Snowflake</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/pr-1695/getting-started/tutorials/continuous-materialized-view/">Create a real-time materialized view in PostgreSQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/pr-1695/getting-started/tutorials/derivations_acmebank/">Implementing Derivations for AcmeBank</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-preview/pr-1695/guides/">User guides</a><button aria-label="Expand sidebar category &#x27;User guides&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-preview/pr-1695/concepts/">Concepts</a><button aria-label="Expand sidebar category &#x27;Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/pr-preview/pr-1695/reference/Connectors/">Reference</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/pr-preview/pr-1695/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Get started</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/pr-preview/pr-1695/getting-started/tutorials/"><span itemprop="name">Tutorials</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Real-time CDC with MongoDB</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown">
<h1>Real-time CDC with MongoDB<a id="real-time-cdc-with-mongodb"></a></h1>
<p>A step-by-step guide to setting up Change Data Capture (CDC) from MongoDB with Estuary Flow.</p>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image4_5c651b17d6/image4_5c651b17d6.png" alt="High level architecture" class="img_ev3q"></p>
<p>MongoDB is still one of the most popular document stores powering web applications today. Due to its flexible schema handling and tight integration with JSON-based libraries developers love working with it. It’s easy to set up, painless to maintain, and works at scale.</p>
<p>Because it’s the centerpiece of so many applications, it’s a common data engineering challenge to extract data out of MongoDB in order to power a data warehouse or enable other downstream use cases, like AI or operational analytics.</p>
<p>This tutorial will guide you through using Estuary Flow to capture data from MongoDB using change data capture (CDC), requiring minimal configuration. By following these steps, you can empower your organization to leverage its application data in just a few minutes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="video-tutorial">Video tutorial<a class="hash-link" aria-label="Direct link to Video tutorial" title="Direct link to Video tutorial" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#video-tutorial">​</a></h2>
<div style="width:640px;height:360px"></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-cdc">What is CDC?<a id="what-is-cdc"></a><a class="hash-link" aria-label="Direct link to what-is-cdc" title="Direct link to what-is-cdc" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#what-is-cdc">​</a></h2>
<p>CDC, or Change Data Capture, is a method used to track and capture changes made to data in a database. It enables the real-time capture of insertions, updates, and deletions, providing a continuous stream of changes.</p>
<p>This stream of data is invaluable for keeping downstream systems synchronized and up-to-date with the source database, facilitating real-time analytics, replication, and data integration. In essence, CDC allows organizations to capture and react to data changes as they occur, ensuring data accuracy and timeliness across their systems.</p>
<p>Optionally, if you are interested in the intricacies of change data capture, head over to <a href="https://estuary.dev/cdc-done-correctly/" target="_blank" rel="noopener noreferrer">this</a> article, where we explain the theory behind it - this is not a requirement for this tutorial, so if you want to dive in head first, keep on reading!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-change-events-in-mongodb">Understanding Change Events in MongoDB<a id="understanding-change-events-in-mongodb"></a><a class="hash-link" aria-label="Direct link to understanding-change-events-in-mongodb" title="Direct link to understanding-change-events-in-mongodb" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#understanding-change-events-in-mongodb">​</a></h2>
<p>Change events in MongoDB are notifications triggered by modifications to the database&#x27;s data, configuration, or structure through a mechanism called <a href="https://www.mongodb.com/docs/manual/changeStreams/" target="_blank" rel="noopener noreferrer">change streams</a>.</p>
<p>Change Streams in MongoDB are a convenient way for CDC, enabling real-time monitoring of data changes without having to directly interact with the underlying oplog. CDC processes leverage Change Streams to subscribe to data changes, capturing detailed events promptly as insertions, updates, or deletions occur.</p>
<p>This approach ensures efficient data propagation to downstream systems, scalability for high-throughput environments, and robust error handling for operations.</p>
<p>MongoDB supports various types of change events, each catering to different aspects of database operations. For data synchronization, the following three events are the only ones that matter:</p>
<ul>
<li>Insert Events: Triggered when new documents are inserted into a collection.</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image5_b1229ced25/image5_b1229ced25.png" alt="Create event" class="img_ev3q"></p>
<ul>
<li>Update Events: Fired upon modifications to existing documents, including field updates and replacements.</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image6_e1604c59d7/image6_e1604c59d7.png" alt="Update event" class="img_ev3q"></p>
<ul>
<li>Delete Events: Signaled when documents are removed from a collection.</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>In MongoDB, if you delete a key from a document, the corresponding change event that gets fired is an &quot;update&quot; event. This may seem counterintuitive at first, but in MongoDB, updates are atomic operations that can modify specific fields within a document, including removing keys. So, when a key is deleted from a document, MongoDB interprets it as an update operation where the specific field (i.e., the key) is being removed, resulting in an &quot;update&quot; event being generated in the oplog.</div></div>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image3_5dc8c9ea52/image3_5dc8c9ea52.png" alt="Delete event" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction-to-estuary-flow">Introduction to Estuary Flow<a id="introduction-to-estuary-flow"></a><a class="hash-link" aria-label="Direct link to introduction-to-estuary-flow" title="Direct link to introduction-to-estuary-flow" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#introduction-to-estuary-flow">​</a></h2>
<p>Estuary is the best tool for integrating CDC streams from MongoDB. Here are a few reasons why:</p>
<ul>
<li>
<p>Unlike ELT vendors, Estuary does streaming CDC and incremental snapshots, not full snapshots or batch change data extraction. This puts less of a load on the source database and lowers latency.</p>
</li>
<li>
<p>Estuary also extracts exactly-and-only-once. As it streams snapshots and changes data it also stores it as a collection for later reuse, such as for backfilling or stream replay. ELT vendors require you to re-extract every time to want to resend the data or restart a change data stream.</p>
</li>
<li>
<p>Estuary supports both real-time and batch. Its streaming latency is within 100ms, and it always extracts in real-time. But it supports any latency from real-time to hours or days for destinations.</p>
</li>
<li>
<p>Estuary guarantees change data is delivered exactly once.</p>
</li>
<li>
<p>Estuary can also maintain type I and type II slowly changing dimensions directly into a target.</p>
</li>
<li>
<p>Estuary streaming has 50MB/sec per connection per table throughput rates, which is 5-10x any other benchmarks for CDC. It also scales horizontally to increase throughput.</p>
</li>
</ul>
<p>Time to build a real-time CDC pipeline!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a id="prerequisites"></a><a class="hash-link" aria-label="Direct link to prerequisites" title="Direct link to prerequisites" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#prerequisites">​</a></h2>
<p>To follow along with the tutorial, you’ll need the following:</p>
<ul>
<li>
<p>An Estuary Flow account. If you haven’t yet, sign up for free <a href="https://dashboard.estuary.dev/register" target="_blank" rel="noopener noreferrer">here</a>. A fully-managed MongoDB Capture connector is ready for you to get started.</p>
</li>
<li>
<p>A MongoDB Atlas cluster: This tutorial uses Atlas as the source database, but Estuary supports other types of MongoDB deployments as well.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-mongodb">Setting up MongoDB<a id="setting-up-mongodb"></a><a class="hash-link" aria-label="Direct link to setting-up-mongodb" title="Direct link to setting-up-mongodb" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#setting-up-mongodb">​</a></h2>
<p>To prepare MongoDB for Estuary Flow, you need to ensure the following prerequisites are met:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="credentials">Credentials<a id="credentials"></a><a class="hash-link" aria-label="Direct link to credentials" title="Direct link to credentials" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#credentials">​</a></h3>
<p>Obtain the necessary credentials for connecting to your MongoDB instance and database. This includes credentials for authentication purposes, typically a username and password.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="read-access">Read Access<a id="read-access"></a><a class="hash-link" aria-label="Direct link to read-access" title="Direct link to read-access" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#read-access">​</a></h3>
<p>Ensure that you have read access to the MongoDB database(s) from which you intend to capture data. MongoDB utilizes Role-Based Access Control (RBAC), so make sure your user account has the appropriate permissions to read data.</p>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image15_627fe98d52/image15_627fe98d52.png" alt="MongoDB built-in roles" class="img_ev3q"></p>
<p>In MongoDB Atlas, any of the built-in Roles will work for the tutorial, but Flow needs at least read permissions over the data you wish to capture if you wish to set up more granular, restricted permissions.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-considerations">Configuration Considerations<a id="configuration-considerations"></a><a class="hash-link" aria-label="Direct link to configuration-considerations" title="Direct link to configuration-considerations" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#configuration-considerations">​</a></h3>
<ol>
<li>
<p>If you haven&#x27;t already, make sure you deploy a Replica Set-type MongoDB cluster. <strong>Change streams</strong> require a replica set in order to work. A replica set is a group of MongoDB deployments that maintain the same data set. If you are working following along with a fresh MongoDB Atlas project, you shouldn’t need to configure anything manually for this, as the default free-tier instance is a cluster of 3 replicas. To learn more about replica sets, see the Replication Introduction in the <a href="https://www.mongodb.com/docs/manual/replication/" target="_blank" rel="noopener noreferrer">MongoDB manual</a>.</p>
</li>
<li>
<p>Ensure that <a href="/pr-preview/pr-1695/reference/allow-ip-addresses/">Estuary&#x27;s IP addresses are allowlisted</a> to allow access. We’ll show you how to do this in the next section.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-mongodb">Configure MongoDB<a id="configure-mongodb"></a><a class="hash-link" aria-label="Direct link to configure-mongodb" title="Direct link to configure-mongodb" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#configure-mongodb">​</a></h3>
<p>Let’s start by provisioning our database. As you can see, for this tutorial, you can just deploy an M0-category cluster, which is free to use.</p>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image12_664e3a1404/image12_664e3a1404.png" alt="MongoDB deployment options" class="img_ev3q"></p>
<p>After the cluster has finished provisioning, we’ll need to make sure that Estuary Flow is able to connect to the database. For this, the only requirement with MongoDB Atlas is allowlisting the <a href="/pr-preview/pr-1695/reference/allow-ip-addresses/">Estuary Flow IP addresses</a>.</p>
<p>Navigate to the “Network Access” page using the left hand sidebar, and using the “Add new IP address” button, create the list entry which enables the communication between the two services.</p>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image13_3294633b1f/image13_3294633b1f.png" alt="Allowlisting Estuary Flow&#x27;s IP" class="img_ev3q"></p>
<p>Next, find your connection string by navigating to the <code>mongosh</code> setup page by clicking the “Connect” button on the database overview section, then choosing the “Shell” option.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>You’re not going to set up <code>mongosh</code> for this tutorial, but this is the easiest way to get ahold of the connection string we’ll be using.</div></div>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image9_81fdbf1a20/image9_81fdbf1a20.png" alt="Grab your MongoDB connection string" class="img_ev3q"></p>
<p>Copy the connection string and head over to your <a href="https://dashboard.estuary.dev/" target="_blank" rel="noopener noreferrer">Estuary Flow dashboard</a> to continue the tutorial.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-estuary-flow">Setting up Estuary Flow<a id="setting-up-estuary-flow"></a><a class="hash-link" aria-label="Direct link to setting-up-estuary-flow" title="Direct link to setting-up-estuary-flow" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#setting-up-estuary-flow">​</a></h2>
<p>On the dashboard, create a new capture by navigating to the “Sources” menu using the sidebar, then pressing the “New Capture” button. In the list of available connectors, search for “MongoDB”, then press “Capture”.</p>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image7_4cd384d7bd/image7_4cd384d7bd.png" alt="Create a Source Capture" class="img_ev3q"></p>
<p>Pressing this button will bring you to the connector configuration page, where you’ll be able to provision your fully managed real-time Data Flow.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mongodb-capture-configuration">MongoDB Capture Configuration<a id="mongodb-capture-configuration"></a><a class="hash-link" aria-label="Direct link to mongodb-capture-configuration" title="Direct link to mongodb-capture-configuration" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#mongodb-capture-configuration">​</a></h3>
<p>As a first step, in the Capture Details section, name your capture and optionally add a description for it.</p>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image14_17211852c9/image14_17211852c9.png" alt="Capture details configuration" class="img_ev3q"></p>
<p>Once you are finished, step down to the second configuration section, called “Endpoint Config”. Here you have to use the address for the database you took a note of in the MongoDB setup section, along with your username and password which you configured when setting up MongoDB Atlas.</p>
<p>If your user has access to all databases, ensure that in your MongoDB address, you specify the <code>?authSource=admin</code> parameter in the connection address. In this case, authentication is performed through your admin database.</p>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image17_80203a1a77/image17_80203a1a77.png" alt="Capture endpoint configuration" class="img_ev3q"></p>
<p>As for the &quot;Database&quot; option, feel free to leave it empty, that way the automated discovery process of Flow will make sure every available database is ready for data extraction.</p>
<p>After you press the blue “Next” button in the top right corner, Flow will automatically crawl through the connection to discover available resources. Next up, you’ll see the third, and final configuration section, where you are able to view and choose from all the databases and collections which are discovered by Flow.</p>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image18_77d0afe861/image18_77d0afe861.png" alt="Capture output collections confuration" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="documents-and-collections">Documents and Collections<a id="documents-and-collections"></a><a class="hash-link" aria-label="Direct link to documents-and-collections" title="Direct link to documents-and-collections" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#documents-and-collections">​</a></h3>
<p>Before we initialize the connector, let’s talk a little bit about how incoming data is represented in Flow.</p>
<p>The <strong>documents</strong> of your flows are stored in <strong>collections</strong>: real-time data lakes of JSON documents in cloud storage.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Keep in mind, these are not the same documents and collections as the ones in MongoDB, only the names are similar, but we are talking about separate systems.</div></div>
<p>Collections being stored in an object storage mean that once you start capturing data, you won’t have to worry about it not being available to replay – object stores such as S3 can be configured to cheaply store data forever. See <a href="https://docs.estuary.dev/concepts/collections/#documents" target="_blank" rel="noopener noreferrer">docs page</a> for more information about documents.</p>
<p>To see how Flow parsed the incoming records, click on the “Collection” tab on the UI.</p>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image16_aa92057159/image16_aa92057159.png" alt="Capture bindings configuration" class="img_ev3q"></p>
<p>When you set up a capture from MongoDB using the Flow web app, the underlying collection specifications will look something like this:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> /_id </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">writeSchema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  properties</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  required</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> _id </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">readSchema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allOf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">$ref</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flow</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//write</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">$ref</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flow</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//inferred</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">schema</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This specification uses separate <a href="https://docs.estuary.dev/concepts/schemas/#write-and-read-schemas" target="_blank" rel="noopener noreferrer">read and write schemas</a>. The <code>writeSchema</code> is extremely permissive, and only requires an <code>_id</code> property with a string value. The <code>readSchema</code> references <code>flow://inferred-schema</code>, which expands to the current inferred schema when the collection is published.</p>
<p>MongoDB documents have a mandatory <code>_id</code> field that is used as the key of the collection. But that is essentially the only requirement. You can&#x27;t know what other fields may exist on MongoDB documents until you&#x27;ve read them.  On the UI, for this reason, only three fields are visible initially in the collection schema tab.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="automating-schema-evolution">Automating schema evolution<a id="automating-schema-evolution"></a><a class="hash-link" aria-label="Direct link to automating-schema-evolution" title="Direct link to automating-schema-evolution" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#automating-schema-evolution">​</a></h3>
<p>In addition to selecting the collections for capture, this interface provides access to three settings that govern schema evolution. In a NoSQL database environment like MongoDB, schema alterations are frequent occurrences. Manually synchronizing source and destination schemas can end up being a lot of maintenance. To help with this, Estuary introduces a more <a href="https://docs.estuary.dev/concepts/advanced/evolutions/#what-do-schema-evolutions-do" target="_blank" rel="noopener noreferrer">sophisticated schema evolution strategy</a>.</p>
<p>With Estuary Flow, teams can opt to suspend the Data Flow using data contracts, automate the update of the target schema with the new MongoDB schema, or create a new table in the destination to maintain separation between old and new schemas. Details can be found in our <a href="https://docs.estuary.dev/concepts/advanced/evolutions/" target="_blank" rel="noopener noreferrer">schema evolution</a> docs.</p>
<p>Schema evolutions serve to prevent errors stemming from discrepancies between specifications in a number of ways:</p>
<ol>
<li>
<p>Materializations will automatically apply backward-compatible schema changes, like adding a new column. This doesn&#x27;t require re-backfilling the target tables or re-creating the Flow collection.</p>
</li>
<li>
<p>For more complex scenarios, the evolution adjusts the affected materialization bindings to increment their backfill counter, prompting the materialization process to reconstruct the resource (such as a database table) and backfill it from the offset.</p>
</li>
<li>
<p>In instances where necessary, such as when the collection key or logical partitioning undergoes changes, the evolution generates a completely new collection with a numerical suffix (e.g., <code>_v2</code>). This new collection initializes as empty and undergoes backfilling from the source. Moreover, the evolution updates all captures and materializations referencing the old collection to point to the new collection, incrementing their backfill counters accordingly. This method is more intricate and is only invoked when essential alterations are identified.</p>
</li>
</ol>
<p>In these scenarios, the names of destination resources remain unaltered. For instance, a materialization to Postgres would drop and re-establish the affected tables with their original names.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="publishing-the-capture">Publishing the Capture<a id="publishing-the-capture"></a><a class="hash-link" aria-label="Direct link to publishing-the-capture" title="Direct link to publishing-the-capture" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#publishing-the-capture">​</a></h3>
<p>To finalize the connector configuration and kick it off, press the “Save and Publish” button. Flow will test, save and publish your capture. You’ll see a similar screen if everything went well or if there were any issues setting up the connector, you’ll see detailed error messages instead.</p>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image2_b4e6afde4d/image2_b4e6afde4d.png" alt="Successful capture publish screen" class="img_ev3q"></p>
<p>During the initial database snapshot – which is triggered automatically – the connector seamlessly captures change events by continuously monitoring change streams while concurrently executing collection scans to backfill pre-existing documents. Following the initial snapshot, the connector perpetually monitors change streams to capture all subsequent changes in real-time.</p>
<p>Incremental backfills in the MongoDB connector follow a straightforward approach to ensure comprehensive data capture with minimal latency. Initially, all tracked change streams are synchronized to maintain data integrity. Then, a targeted backfilling effort occurs across MongoDB collections until all are up to date. Continuous monitoring via change streams ensures ongoing data capture and means there is no need to pause replication during an ongoing backfill.</p>
<p>In the event of a pause in the connector&#x27;s process, it resumes capturing change events from the point of interruption. However, the connector&#x27;s ability to accomplish this depends on the size of the replica set oplog. In certain scenarios where the pause duration is significant enough for the oplog to purge old change events, the connector may necessitate redoing the backfill to maintain data consistency.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>To ensure reliable data capture, it is recommended to <a href="https://www.mongodb.com/docs/manual/tutorial/change-oplog-size/#c.-change-the-oplog-size-of-the-replica-set-member" target="_blank" rel="noopener noreferrer">adjust the oplog size</a> or set a <a href="https://www.mongodb.com/docs/manual/reference/command/replSetResizeOplog/#minimum-oplog-retention-period" target="_blank" rel="noopener noreferrer">minimum retention period</a>. A recommended minimum retention period of at least 24 hours is sufficient for most cases.</div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="real-time-cdc">Real-time CDC<a id="real-time-cdc"></a><a class="hash-link" aria-label="Direct link to real-time-cdc" title="Direct link to real-time-cdc" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#real-time-cdc">​</a></h2>
<p>Let’s head over to the collections page to see our arriving documents.</p>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image8_515f331796/image8_515f331796.png" alt="Collections" class="img_ev3q"></p>
<p>Looks like all of the selected MongoDB collections have been fully replicated into Flow by the initial backfill.</p>
<p>Let’s take a look at the <code>movies</code> collection to see what details Flow can tell us about the documents. You can see some statistics about the integration throughput and you can also take a look at the actual documents in a preview window.</p>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image10_77731295df/image10_77731295df.png" alt="Collection details" class="img_ev3q"></p>
<p>You can also check out the generated specification, which is the Flow’s behind-the-scenes declarative way of representing the Collection resource.</p>
<p>For the <code>movies</code> collection, this is what it looks like:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;writeSchema&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;type&quot;: &quot;object&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;required&quot;: [&quot;_id&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;properties&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;_id&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;string&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;_meta&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;$schema&quot;: &quot;http://json-schema.org/draft/2020-12/schema&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;properties&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;op&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;type&quot;: &quot;string&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;enum&quot;: [&quot;c&quot;, &quot;u&quot;, &quot;d&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;title&quot;: &quot;Change Operation&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;description&quot;: &quot;Change operation type: &#x27;c&#x27; Create/Insert &#x27;u&#x27; Update &#x27;d&#x27; Delete.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;object&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;x-infer-schema&quot;: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;readSchema&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;allOf&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;$ref&quot;: &quot;flow://write-schema&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;$ref&quot;: &quot;flow://inferred-schema&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;key&quot;: [&quot;/_id&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can see the flexible <code>readSchema</code> configuration in action we mentioned above.</p>
<p>You can use the preview window on the collections “Overview” page to quickly test how change events propagate from MongoDB. Head over to the MongoDB Atlas UI and insert a new document into the <code>movies</code> collection.</p>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image1_0a5fb197d3/image1_0a5fb197d3.png" alt="Insert new document" class="img_ev3q"></p>
<p>Here’s a sample JSON (describing non-existent but very intriguing movie) you can copy paste into the pop-up modal to spare you the trouble.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;title&quot;: &quot;Dataflow&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;fullplot&quot;: &quot;In a near-future world driven by data, a team of maverick engineers and programmers set out to revolutionize the way information is processed and transmitted. As they delve deeper into the complexities of real-time data streaming, they uncover dark secrets and face moral dilemmas that threaten to unravel their ambitious project.&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;plot&quot;: &quot;A team of brilliant engineers embark on a groundbreaking project to develop a real-time data streaming platform, but they soon discover unexpected challenges and threats lurking in the digital realm.&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;genres&quot;: [&quot;Drama&quot;, &quot;Sci-Fi&quot;, &quot;Thriller&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;runtime&quot;: 135,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;cast&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Emily Blunt&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Michael B. Jordan&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Idris Elba&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Zendaya&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Oscar Isaac&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;poster&quot;: &quot;https://example.com/posters/real-time-data-streaming.jpg&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;languages&quot;: [&quot;English&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;released&quot;: 1739808000000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;directors&quot;: [&quot;Christopher Nolan&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;rated&quot;: &quot;PG-13&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;awards&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;wins&quot;: 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;nominations&quot;: 8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;text&quot;: &quot;3 wins, 8 nominations&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;lastupdated&quot;: &quot;2024-04-30 10:15:00.000000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;year&quot;: 2024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;imdb&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;rating&quot;: 8.5,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;votes&quot;: 15234,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;id&quot;: 1001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;countries&quot;: [&quot;USA&quot;, &quot;United Kingdom&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;type&quot;: &quot;movie&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;tomatoes&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;viewer&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;rating&quot;: 4.2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;numReviews&quot;: 3856,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;meter&quot;: 82</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;fresh&quot;: 34,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;critic&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;rating&quot;: 8.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;numReviews&quot;: 22,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;meter&quot;: 91</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;rotten&quot;: 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;lastUpdated&quot;: 1739894400000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;num_mflix_comments&quot;: 120</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After you insert the document, check out the collection preview on the Flow UI to verify it has indeed arrived. The process for updating and deleting collections in MongoDB works similarly.</p>
<p><img decoding="async" loading="lazy" src="https://storage.googleapis.com/estuary-marketing-strapi-uploads/uploads//image11_772715227c/image11_772715227c.png" alt="CDC event verification" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="wrapping-up">Wrapping up<a id="wrapping-up"></a><a class="hash-link" aria-label="Direct link to wrapping-up" title="Direct link to wrapping-up" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#wrapping-up">​</a></h2>
<p>In this tutorial, you set up a MongoDB Change Data Capture (CDC) integration using Estuary Flow. Throughout the process, you learned about the technical nuances of capturing and synchronizing data changes from MongoDB collections in real-time.</p>
<p>Key takeaways from this tutorial:</p>
<ul>
<li>
<p>MongoDB&#x27;s document-based approach and schema flexibility present unique challenges and opportunities for Change Data Capture workflows.</p>
</li>
<li>
<p>You explored the prerequisites and configuration settings required to establish a seamless connection between MongoDB and Estuary, ensuring efficient data capture and synchronization.</p>
</li>
<li>
<p>Estuary&#x27;s schema evolution capabilities enable data teams to manage schema changes effectively, ensuring data consistency and integrity across source and destination systems.</p>
</li>
<li>
<p>You learned how Flow continuously monitors MongoDB change streams and executes backfilling processes to capture changes accurately, even in the event of interruptions or schema alterations.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="next-steps">Next Steps<a id="next-steps"></a><a class="hash-link" aria-label="Direct link to next-steps" title="Direct link to next-steps" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#next-steps">​</a></h2>
<p>That’s it! You should have everything you need to know to create your own data pipeline for capturing change events from MongoDB!</p>
<p>Now try it out on your own CloudSQL database or other sources.</p>
<p>If you want to learn more, make sure you read through the <a href="https://docs.estuary.dev/" target="_blank" rel="noopener noreferrer">Estuary documentation</a>.</p>
<p>You’ll find instructions on how to use other connectors <a href="https://docs.estuary.dev/" target="_blank" rel="noopener noreferrer">here</a>. There are more tutorials <a href="https://docs.estuary.dev/guides/" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>Also, don’t forget to join the <a href="https://estuary-dev.slack.com/ssb/redirect#/shared-invite/email" target="_blank" rel="noopener noreferrer">Estuary Slack Community</a>!</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/estuary/flow/edit/master/site/docs/getting-started/tutorials/real-time-cdc-with-mongodb.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/pr-preview/pr-1695/getting-started/tutorials/postgresql_cdc_to_snowflake/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">PostgreSQL CDC streaming to Snowflake</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/pr-preview/pr-1695/getting-started/tutorials/dataflow-s3-snowflake/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Create your first dataflow with Amazon S3 and Snowflake</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#video-tutorial">Video tutorial</a></li><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#what-is-cdc">What is CDC?<a></a></a></li><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#understanding-change-events-in-mongodb">Understanding Change Events in MongoDB<a></a></a></li><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#introduction-to-estuary-flow">Introduction to Estuary Flow<a></a></a></li><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#prerequisites">Prerequisites<a></a></a></li><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#setting-up-mongodb">Setting up MongoDB<a></a></a><ul><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#credentials">Credentials<a></a></a></li><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#read-access">Read Access<a></a></a></li><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#configuration-considerations">Configuration Considerations<a></a></a></li><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#configure-mongodb">Configure MongoDB<a></a></a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#setting-up-estuary-flow">Setting up Estuary Flow<a></a></a><ul><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#mongodb-capture-configuration">MongoDB Capture Configuration<a></a></a></li><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#documents-and-collections">Documents and Collections<a></a></a></li><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#automating-schema-evolution">Automating schema evolution<a></a></a></li><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#publishing-the-capture">Publishing the Capture<a></a></a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#real-time-cdc">Real-time CDC<a></a></a></li><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#wrapping-up">Wrapping up<a></a></a></li><li><a class="table-of-contents__link toc-highlight" href="/pr-preview/pr-1695/getting-started/tutorials/real_time_cdc_with_mongodb/#next-steps">Next Steps<a></a></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/pr-preview/pr-1695/">Flow Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/EstuaryDev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/estuary/flow" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Estuary Technologies, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>