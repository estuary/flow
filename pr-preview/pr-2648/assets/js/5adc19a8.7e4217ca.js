"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[8515],{28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var d=s(96540);const i={},r=d.createContext(i);function t(e){const n=d.useContext(r);return d.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),d.createElement(r.Provider,{value:n},e.children)}},54829:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>d,toc:()=>a});const d=JSON.parse('{"id":"guides/advanced-usage/metadata-fields","title":"Document Metadata Fields","description":"Captures automatically add a _meta object to every document they produce. This metadata tracks change operations, source location, and ordering information essential for understanding where data came from and how to process it correctly.","source":"@site/docs/guides/advanced-usage/metadata-fields.md","sourceDirName":"guides/advanced-usage","slug":"/guides/advanced-usage/metadata-fields","permalink":"/pr-preview/pr-2648/guides/advanced-usage/metadata-fields","draft":false,"unlisted":false,"editUrl":"https://github.com/estuary/flow/edit/master/site/docs/guides/advanced-usage/metadata-fields.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Google Cloud IAM Authentication","permalink":"/pr-preview/pr-2648/guides/iam-auth/gcp"},"next":{"title":"Feature Flags","permalink":"/pr-preview/pr-2648/guides/advanced-usage/feature-flags"}}');var i=s(74848),r=s(28453);const t={sidebar_position:1},l="Document Metadata Fields",c={},a=[{value:"Standard Fields",id:"standard-fields",level:2},{value:"_meta.uuid and flow_published_at",id:"_metauuid-and-flow_published_at",level:3},{value:"Delete Events",id:"delete-events",level:3},{value:"Common Source Fields (SQL Captures)",id:"common-source-fields-sql-captures",level:2},{value:"Connector-Specific Source Fields",id:"connector-specific-source-fields",level:2},{value:"PostgreSQL",id:"postgresql",level:3},{value:"MySQL",id:"mysql",level:3},{value:"SQL Server (CDC)",id:"sql-server-cdc",level:3},{value:"SQL Server (Change Tracking)",id:"sql-server-change-tracking",level:3},{value:"Oracle",id:"oracle",level:3},{value:"MongoDB",id:"mongodb",level:3},{value:"Snowflake",id:"snowflake",level:3},{value:"Example Document",id:"example-document",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Filtering by Operation Type",id:"filtering-by-operation-type",level:3},{value:"Ordering Events by Source Timestamp",id:"ordering-events-by-source-timestamp",level:3},{value:"Identifying Source Table",id:"identifying-source-table",level:3},{value:"Using Source Tags",id:"using-source-tags",level:3},{value:"Distinguishing Backfill from Real-time",id:"distinguishing-backfill-from-real-time",level:3}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"document-metadata-fields",children:"Document Metadata Fields"})}),"\n",(0,i.jsxs)(n.p,{children:["Captures automatically add a ",(0,i.jsx)(n.code,{children:"_meta"})," object to every document they produce. This metadata tracks change operations, source location, and ordering information essential for understanding where data came from and how to process it correctly."]}),"\n",(0,i.jsx)(n.h2,{id:"standard-fields",children:"Standard Fields"}),"\n",(0,i.jsxs)(n.p,{children:["All captures include these standard ",(0,i.jsx)(n.code,{children:"_meta"})," fields:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"_meta.uuid"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"V1 UUID uniquely identifying the document"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"_meta.op"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:["Operation type: ",(0,i.jsx)(n.code,{children:'"c"'})," (create), ",(0,i.jsx)(n.code,{children:'"u"'})," (update), ",(0,i.jsx)(n.code,{children:'"d"'})," (delete)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"_meta.source"})}),(0,i.jsx)(n.td,{children:"object"}),(0,i.jsx)(n.td,{children:"Source-specific metadata (varies by connector)"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"_metauuid-and-flow_published_at",children:"_meta.uuid and flow_published_at"}),"\n",(0,i.jsxs)(n.p,{children:["Every document has a ",(0,i.jsx)(n.code,{children:"_meta.uuid"})," field containing a v1 UUID. This UUID:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Uniquely identifies each document globally"}),"\n",(0,i.jsx)(n.li,{children:"Contains an encoded timestamp of when the document was published to the collection"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"flow_published_at"})," projection is automatically derived from the UUID's timestamp component. It's available in every collection and useful for:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Tracking when documents were last modified"}),"\n",(0,i.jsxs)(n.li,{children:["Incremental processing in materializations (via time travel ",(0,i.jsx)(n.code,{children:"notBefore"}),"/",(0,i.jsx)(n.code,{children:"notAfter"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Ordering events chronologically"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"delete-events",children:"Delete Events"}),"\n",(0,i.jsxs)(n.p,{children:["Delete events (",(0,i.jsx)(n.code,{children:'op: "d"'}),") contain only the document key and ",(0,i.jsx)(n.code,{children:"_meta"})," fields\u2014other fields are omitted. When processing deletes, use the key to identify which document was removed."]}),"\n",(0,i.jsx)(n.h2,{id:"common-source-fields-sql-captures",children:"Common Source Fields (SQL Captures)"}),"\n",(0,i.jsxs)(n.p,{children:["Most SQL database captures share these ",(0,i.jsx)(n.code,{children:"_meta.source"})," fields:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ts_ms"})}),(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsx)(n.td,{children:"Unix timestamp in milliseconds when the event was recorded"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"schema"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Database schema name"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"table"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Table name"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"snapshot"})}),(0,i.jsx)(n.td,{children:"boolean"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"true"})," if from initial backfill, ",(0,i.jsx)(n.code,{children:"false"})," if from replication log"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"tag"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Custom source tag (if configured in Advanced Options)"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"connector-specific-source-fields",children:"Connector-Specific Source Fields"}),"\n",(0,i.jsx)(n.h3,{id:"postgresql",children:"PostgreSQL"}),"\n",(0,i.jsx)(n.p,{children:"Additional fields beyond common:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"loc"})}),(0,i.jsx)(n.td,{children:"array"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"[lastCommitEndLSN, eventLSN, currentBeginFinalLSN]"})," for WAL ordering"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"txid"})}),(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsx)(n.td,{children:"PostgreSQL transaction ID"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"mysql",children:"MySQL"}),"\n",(0,i.jsx)(n.p,{children:"Additional fields beyond common:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cursor"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:["Binlog position as ",(0,i.jsx)(n.code,{children:"binlog_file:binlog_offset:row_index"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"txid"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Global transaction ID (if GTIDs enabled)"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"sql-server-cdc",children:"SQL Server (CDC)"}),"\n",(0,i.jsx)(n.p,{children:"Additional fields beyond common:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"lsn"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:["Log sequence number in format ",(0,i.jsx)(n.code,{children:"00000000:00000000:0001"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"seqval"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Base64-encoded sequence value for ordering within transaction"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"updateMask"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Bit mask of updated columns"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"sql-server-change-tracking",children:"SQL Server (Change Tracking)"}),"\n",(0,i.jsx)(n.p,{children:"Additional fields beyond common:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"version"})}),(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsx)(n.td,{children:"Change Tracking version number"})]})})]}),"\n",(0,i.jsx)(n.h3,{id:"oracle",children:"Oracle"}),"\n",(0,i.jsx)(n.p,{children:"Additional fields beyond common:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"scn"})}),(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsx)(n.td,{children:"System Change Number"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"row_id"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Oracle ROWID"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"rs_id"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Record Set ID"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ssn"})}),(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsx)(n.td,{children:"SQL Sequence Number"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"mongodb",children:"MongoDB"}),"\n",(0,i.jsxs)(n.p,{children:["MongoDB uses a different structure with ",(0,i.jsx)(n.code,{children:"db"})," and ",(0,i.jsx)(n.code,{children:"collection"})," instead of ",(0,i.jsx)(n.code,{children:"schema"})," and ",(0,i.jsx)(n.code,{children:"table"}),":"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"db"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Database name"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"collection"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Collection name"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"snapshot"})}),(0,i.jsx)(n.td,{children:"boolean"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"true"})," if from backfill, ",(0,i.jsx)(n.code,{children:"false"})," if from change stream"]})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["MongoDB also supports ",(0,i.jsx)(n.code,{children:"_meta.before"})," containing the pre-image of documents (if pre-images are enabled in the source database)."]}),"\n",(0,i.jsx)(n.h3,{id:"snowflake",children:"Snowflake"}),"\n",(0,i.jsx)(n.p,{children:"Additional fields beyond common:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"seq"})}),(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsx)(n.td,{children:"Sequence number of staging table"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"off"})}),(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsx)(n.td,{children:"Offset within staging table"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"example-document",children:"Example Document"}),"\n",(0,i.jsxs)(n.p,{children:["Here's an example document from a PostgreSQL capture showing the complete ",(0,i.jsx)(n.code,{children:"_meta"})," structure:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "id": 12345,\n  "name": "Example Record",\n  "updated_at": "2024-01-15T10:30:00Z",\n  "_meta": {\n    "op": "u",\n    "source": {\n      "ts_ms": 1705315800000,\n      "schema": "public",\n      "table": "records",\n      "snapshot": false,\n      "loc": [516715804872, 516715805272, 516715805488]\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsx)(n.h3,{id:"filtering-by-operation-type",children:"Filtering by Operation Type"}),"\n",(0,i.jsx)(n.p,{children:"In derivations, filter documents by operation type to handle creates, updates, and deletes differently:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Only process creates and updates, ignore deletes\nSELECT * FROM source_collection WHERE _meta.op != 'd'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"ordering-events-by-source-timestamp",children:"Ordering Events by Source Timestamp"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"_meta.source.ts_ms"})," to order events by when they occurred in the source system:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM events ORDER BY _meta.source.ts_ms\n"})}),"\n",(0,i.jsx)(n.h3,{id:"identifying-source-table",children:"Identifying Source Table"}),"\n",(0,i.jsx)(n.p,{children:"In multi-table captures, use schema and table to route documents:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Process only records from the orders table\nSELECT * FROM capture WHERE _meta.source.table = 'orders'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"using-source-tags",children:"Using Source Tags"}),"\n",(0,i.jsx)(n.p,{children:"When capturing from multiple database replicas, configure different tags in Advanced Options to distinguish them:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Filter by source tag\nSELECT * FROM capture WHERE _meta.source.tag = 'us-east-replica'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"distinguishing-backfill-from-real-time",children:"Distinguishing Backfill from Real-time"}),"\n",(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.code,{children:"snapshot"})," field to handle backfilled historical data differently from real-time changes:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Only process real-time changes\nSELECT * FROM capture WHERE _meta.source.snapshot = false\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}}}]);