"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[1419],{96192:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>c,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"reference/Connectors/materialization-connectors/databricks","title":"Databricks","description":"This connector materializes Flow collections into tables in a Databricks SQL Warehouse.","source":"@site/docs/reference/Connectors/materialization-connectors/databricks.md","sourceDirName":"reference/Connectors/materialization-connectors","slug":"/reference/Connectors/materialization-connectors/databricks","permalink":"/pr-preview/pr-2431/reference/Connectors/materialization-connectors/databricks","draft":false,"unlisted":false,"editUrl":"https://github.com/estuary/flow/edit/master/site/docs/reference/Connectors/materialization-connectors/databricks.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Google BigQuery","permalink":"/pr-preview/pr-2431/reference/Connectors/materialization-connectors/BigQuery"},"next":{"title":"Dekaf","permalink":"/pr-preview/pr-2431/reference/Connectors/materialization-connectors/Dekaf/"}}');var r=t(74848),i=t(28453),a=t(13554),d=t.n(a);const c={},l="Databricks",o={},h=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Setup",id:"setup",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Properties",id:"properties",level:3},{value:"Endpoint",id:"endpoint",level:4},{value:"Bindings",id:"bindings",level:4},{value:"Sample",id:"sample",level:3},{value:"Sync Schedule",id:"sync-schedule",level:2},{value:"Delta updates",id:"delta-updates",level:2},{value:"Column mapping",id:"column-mapping",level:2},{value:"Reserved words",id:"reserved-words",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"databricks",children:"Databricks"})}),"\n",(0,r.jsxs)(n.p,{children:["This connector materializes Flow collections into tables in a Databricks SQL Warehouse.\nIt allows both standard and ",(0,r.jsx)(n.a,{href:"#delta-updates",children:"delta updates"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The connector first uploads data changes to a ",(0,r.jsx)(n.a,{href:"https://docs.databricks.com/en/sql/language-manual/sql-ref-volumes.html",children:"Databricks Unity Catalog Volume"}),".\nFrom there, it transactionally applies the changes to the Databricks tables."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://ghcr.io/estuary/materialize-databricks:dev",children:(0,r.jsx)(n.code,{children:"ghcr.io/estuary/materialize-databricks:dev"})})," provides the latest connector image. You can also follow the link in your browser to see past image versions."]}),"\n",(0,r.jsx)(d(),{controls:!0,url:"https://www.youtube.com/watch?v=rXb2NQi6XYQ"}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.p,{children:"To use this connector, you'll need:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["A Databricks account that includes:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A unity catalog"}),"\n",(0,r.jsx)(n.li,{children:"A SQL Warehouse"}),"\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.a,{href:"https://docs.databricks.com/api/workspace/schemas",children:"schema"})," \u2014 a logical grouping of tables in a catalog"]}),"\n",(0,r.jsx)(n.li,{children:"A user or service principal with a role assigned that grants the appropriate access levels to these resources."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"At least one Flow collection"}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["If you haven't yet captured your data from its external source, start at the beginning of the ",(0,r.jsx)(n.a,{href:"/pr-preview/pr-2431/guides/create-dataflow",children:"guide to create a dataflow"}),". You'll be referred back to this connector-specific documentation at the appropriate steps."]})}),"\n",(0,r.jsx)(n.h3,{id:"setup",children:"Setup"}),"\n",(0,r.jsxs)(n.p,{children:["You need to first create a SQL Warehouse if you don't already have one in your account. See ",(0,r.jsx)(n.a,{href:"https://docs.databricks.com/en/sql/admin/create-sql-warehouse.html",children:"Databricks documentation"})," on configuring a Databricks SQL Warehouse. After creating a SQL Warehouse, you can find the details necessary for connecting to it under the ",(0,r.jsx)(n.strong,{children:"Connection Details"})," tab."]}),"\n",(0,r.jsxs)(n.p,{children:["In order to save on costs, we recommend that you set the Auto Stop parameter for your SQL warehouse to the minimum available. Estuary's Databricks connector automatically delays updates to the destination according to the configured ",(0,r.jsx)(n.strong,{children:"Sync Schedule"})," (see configuration details below), with a default delay value of 30 minutes."]}),"\n",(0,r.jsxs)(n.p,{children:["You also need an access token for your user or service principal to be used by our connector, see the respective documentation for ",(0,r.jsx)(n.a,{href:"https://docs.databricks.com/en/administration-guide/access-control/tokens.html",children:"user personal access tokens"})," and ",(0,r.jsx)(n.a,{href:"https://docs.databricks.com/en/admin/users-groups/service-principals.html#manage-personal-access-tokens-for-a-service-principal",children:"service principal access tokens"}),' from Databricks on how to create an access token. Note that as of this writing, only service principals in the "admins" group can use a token.']}),"\n",(0,r.jsx)(n.p,{children:"To create an access token for your service principal:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Make sure that they are part of the admins group by going to Settings -> Identity and access -> Groups -> admins -> Members and adding the service principal"}),"\n",(0,r.jsx)(n.li,{children:'Find their "Application ID" by going to Settings -> Identity and access -> Service Principals'}),"\n",(0,r.jsxs)(n.li,{children:["Create an access token on behalf of the service principal using the ",(0,r.jsx)(n.a,{href:"https://docs.databricks.com/en/dev-tools/cli/install.html",children:"databricks CLI"})]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"databricks token-management create-obo-token <application id of service principal>\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsxs)(n.li,{children:["Copy the ",(0,r.jsx)(n.code,{children:"token_value"})," value of the resulting JSON from the command above"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.p,{children:"To use this connector, begin with data in one or more Flow collections.\nUse the below properties to configure a Databricks materialization, which will direct one or more of your Flow collections to new Databricks tables."}),"\n",(0,r.jsx)(n.h3,{id:"properties",children:"Properties"}),"\n",(0,r.jsx)(n.h4,{id:"endpoint",children:"Endpoint"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Property"}),(0,r.jsx)(n.th,{children:"Title"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Required/Default"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/address"})})}),(0,r.jsx)(n.td,{children:"Address"}),(0,r.jsxs)(n.td,{children:["Host and port of the SQL warehouse (in the form of host[",":port","]). Port 443 is used as the default if no specific port is provided."]}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/http_path"})})}),(0,r.jsx)(n.td,{children:"HTTP Path"}),(0,r.jsx)(n.td,{children:"HTTP path of your SQL warehouse"}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/catalog_name"})})}),(0,r.jsx)(n.td,{children:"Catalog Name"}),(0,r.jsx)(n.td,{children:"Name of your Unity Catalog"}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/schema_name"})})}),(0,r.jsx)(n.td,{children:"Schema Name"}),(0,r.jsx)(n.td,{children:"Default schema to materialize to"}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"default"})," schema is used"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/credentials"})})}),(0,r.jsx)(n.td,{children:"Credentials"}),(0,r.jsx)(n.td,{children:"Authentication credentials"}),(0,r.jsx)(n.td,{children:"object"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/credentials/auth_type"})})}),(0,r.jsx)(n.td,{children:"Role"}),(0,r.jsxs)(n.td,{children:["Authentication type, set to ",(0,r.jsx)(n.code,{children:"PAT"})," for personal access token"]}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/credentials/personal_access_token"})})}),(0,r.jsx)(n.td,{children:"Role"}),(0,r.jsx)(n.td,{children:"Access Token"}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"bindings",children:"Bindings"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Property"}),(0,r.jsx)(n.th,{children:"Title"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Required/Default"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/table"})})}),(0,r.jsx)(n.td,{children:"Table"}),(0,r.jsx)(n.td,{children:"Table name"}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/schema"})}),(0,r.jsx)(n.td,{children:"Alternative Schema"}),(0,r.jsx)(n.td,{children:"Alternative schema for this table"}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/delta_updates"})}),(0,r.jsx)(n.td,{children:"Delta updates"}),(0,r.jsxs)(n.td,{children:["Whether to use standard or ",(0,r.jsx)(n.a,{href:"#delta-updates",children:"delta updates"})]}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"sample",children:"Sample"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"\nmaterializations:\n  ${PREFIX}/${mat_name}:\n    endpoint:\n  \t    connector:\n    \t    config:\n              address: dbc-abcdefgh-a12b.cloud.databricks.com\n              catalog_name: main\n              http_path: /sql/1.0/warehouses/abcd123efgh4567\n              schema_name: default\n              credentials:\n                auth_type: PAT\n                personal_access_token: secret\n    \t    image: ghcr.io/estuary/materialize-databricks:dev\n  # If you have multiple collections you need to materialize, add a binding for each one\n    # to ensure complete data flow-through\n    bindings:\n  \t- resource:\n      \ttable: ${table_name}\n        schema: default\n    source: ${PREFIX}/${source_collection}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"sync-schedule",children:"Sync Schedule"}),"\n",(0,r.jsxs)(n.p,{children:["This connector supports configuring a schedule for sync frequency. You can read\nabout how to configure this ",(0,r.jsx)(n.a,{href:"/pr-preview/pr-2431/reference/materialization-sync-schedule",children:"here"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"delta-updates",children:"Delta updates"}),"\n",(0,r.jsxs)(n.p,{children:["This connector supports both standard (merge) and ",(0,r.jsx)(n.a,{href:"/pr-preview/pr-2431/concepts/materialization#delta-updates",children:"delta updates"}),".\nThe default is to use standard updates."]}),"\n",(0,r.jsx)(n.p,{children:"Enabling delta updates will prevent Flow from querying for documents in your Databricks table, which can reduce latency and costs for large datasets.\nIf you're certain that all events will have unique keys, enabling delta updates is a simple way to improve\nperformance with no effect on the output.\nHowever, enabling delta updates is not suitable for all workflows, as the resulting table in Databricks won't be fully reduced."}),"\n",(0,r.jsx)(n.p,{children:"You can enable delta updates on a per-binding basis:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"    bindings:\n  \t- resource:\n      \ttable: ${table_name}\n        schema: default\n        delta_updates: true\n    source: ${PREFIX}/${source_collection}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"column-mapping",children:"Column mapping"}),"\n",(0,r.jsxs)(n.p,{children:["If your Databricks setup does not support column alteration, you can enable ",(0,r.jsx)(n.a,{href:"https://docs.databricks.com/aws/en/delta/column-mapping",children:"column mapping"}),".\nThis requires Delta protocol reader version 2+ and writer version 5+; column mapping will not work well with legacy workloads."]}),"\n",(0,r.jsx)(n.p,{children:"To enable column mapping, along with ensuring the correct protocol versions, you can run:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"ALTER TABLE <table-name>\nSET TBLPROPERTIES (\n  'delta.columnMapping.mode' = 'name'\n);\nALTER TABLE <table-name>\nSET TBLPROPERTIES (\n  delta.minReaderVersion = 2,\n  delta.minWriterVersion = 5\n);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"reserved-words",children:"Reserved words"}),"\n",(0,r.jsxs)(n.p,{children:["Databricks has a list of reserved words that must be quoted in order to be used as an identifier. Flow automatically quotes fields that are in the reserved words list. You can find this list in Databricks's documentation ",(0,r.jsx)(n.a,{href:"https://docs.databricks.com/en/sql/language-manual/sql-ref-reserved-words.html",children:"here"})," and in the table below."]}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["In Databricks, objects created with quoted identifiers must always be referenced exactly as created, including the quotes. Otherwise, SQL statements and queries can result in errors. See the ",(0,r.jsx)(n.a,{href:"https://docs.databricks.com/en/sql-reference/identifiers-syntax.html#double-quoted-identifiers",children:"Databricks docs"}),"."]})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Reserved words"}),(0,r.jsx)(n.th,{})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ANTI"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"EXCEPT"}),(0,r.jsx)(n.td,{children:"FULL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"INNER"}),(0,r.jsx)(n.td,{children:"INTERSECT"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"JOIN"}),(0,r.jsx)(n.td,{children:"LATERAL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"LEFT"}),(0,r.jsx)(n.td,{children:"MINUS"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"NATURAL"}),(0,r.jsx)(n.td,{children:"ON"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"RIGHT"}),(0,r.jsx)(n.td,{children:"SEMI"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"SEMI"}),(0,r.jsx)(n.td,{children:"USING"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"NULL"}),(0,r.jsx)(n.td,{children:"DEFAULT"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TRUE"}),(0,r.jsx)(n.td,{children:"FALSE"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CROSS"}),(0,r.jsx)(n.td,{})]})]})]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}}}]);