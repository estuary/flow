"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[9595],{81490:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>x,frontMatter:()=>l,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"reference/Connectors/materialization-connectors/amazon-s3-iceberg","title":"Apache Iceberg Tables in Amazon S3  (delta updates)","description":"This connector materializes delta updates of Flow collections into Apache Iceberg tables using Amazon S3 for object storage and AWS Glue as the Iceberg catalog.","source":"@site/docs/reference/Connectors/materialization-connectors/amazon-s3-iceberg.md","sourceDirName":"reference/Connectors/materialization-connectors","slug":"/reference/Connectors/materialization-connectors/amazon-s3-iceberg","permalink":"/reference/Connectors/materialization-connectors/amazon-s3-iceberg","draft":false,"unlisted":false,"editUrl":"https://github.com/estuary/flow/edit/master/site/docs/reference/Connectors/materialization-connectors/amazon-s3-iceberg.md","tags":[],"version":"current","frontMatter":{"description":"This connector materializes delta updates of Flow collections into Apache Iceberg tables using Amazon S3 for object storage and AWS Glue as the Iceberg catalog."},"sidebar":"tutorialSidebar","previous":{"title":"CSV Files in Amazon S3","permalink":"/reference/Connectors/materialization-connectors/amazon-s3-csv"},"next":{"title":"Apache Parquet Files in Amazon S3","permalink":"/reference/Connectors/materialization-connectors/amazon-s3-parquet"}}');var r=t(74848),i=t(28453),c=t(13554),d=t.n(c);const l={description:"This connector materializes delta updates of Flow collections into Apache Iceberg tables using Amazon S3 for object storage and AWS Glue as the Iceberg catalog."},a="Apache Iceberg Tables in Amazon S3  (delta updates)",o={},h=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Properties",id:"properties",level:3},{value:"Endpoint",id:"endpoint",level:4},{value:"Bindings",id:"bindings",level:4},{value:"Sample",id:"sample",level:3},{value:"Iceberg Column Types",id:"iceberg-column-types",level:2},{value:"Table Maintenance",id:"table-maintenance",level:2},{value:"At-Least-Once Semantics",id:"at-least-once-semantics",level:2}];function j(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"apache-iceberg-tables-in-amazon-s3--delta-updates",children:"Apache Iceberg Tables in Amazon S3  (delta updates)"})}),"\n",(0,r.jsxs)(n.p,{children:["This connector materializes ",(0,r.jsx)(n.a,{href:"/concepts/materialization#delta-updates",children:"delta updates"})," of\nFlow collections into Apache Iceberg tables using Amazon S3 for object storage and ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/glue/latest/dg/aws-glue-programming-etl-format-iceberg.html",children:"AWS\nGlue"})," as\nthe Iceberg catalog."]}),"\n",(0,r.jsx)(n.p,{children:"The delta updates are batched within Flow, converted to parquet files, and then append to Iceberg\ntables at a time interval that you set."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://ghcr.io/estuary/materialize-s3-iceberg:dev",children:(0,r.jsx)(n.code,{children:"ghcr.io/estuary/materialize-s3-iceberg:dev"})}),"\nprovides the latest connector image. You can also follow the link in your browser to see past image\nversions."]}),"\n",(0,r.jsx)(d(),{controls:!0,url:"https://www.youtube.com/watch?v=s0kGGp17pBg"}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.p,{children:"To use this connector, you'll need:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["An S3 bucket to write files to. See ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-overview.html",children:"this\nguide"})," for\ninstructions on setting up a new S3 bucket."]}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["An AWS root or IAM user with ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_examples_s3_rw-bucket.html",children:"read and write\naccess"}),"\nto the S3 bucket. For this user, you'll need the ",(0,r.jsx)(n.strong,{children:"access key"})," and ",(0,r.jsx)(n.strong,{children:"secret\naccess key"}),". See the ",(0,r.jsx)(n.a,{href:"https://aws.amazon.com/blogs/security/wheres-my-secret-access-key/",children:"AWS\nblog"})," for\nhelp finding these credentials."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["If using the ",(0,r.jsx)(n.strong,{children:"AWS Glue Catalog"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The AWS root or IAM user must have access to AWS Glue. See ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/glue/latest/dg/set-up-iam.html",children:"this\nguide"})," for\ninstructions on setting up IAM permissions for a user to access AWS Glue."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["If using the ",(0,r.jsx)(n.strong,{children:"REST Catalog"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The URI for connecting to the catalog."}),"\n",(0,r.jsx)(n.li,{children:"The name of the warehouse to connect to."}),"\n",(0,r.jsx)(n.li,{children:"Credentials for connecting to the catalog."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.p,{children:"Use the below properties to configure the materialization, which will direct one or more of your\nFlow collections to your tables."}),"\n",(0,r.jsx)(n.h3,{id:"properties",children:"Properties"}),"\n",(0,r.jsx)(n.h4,{id:"endpoint",children:"Endpoint"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Property"}),(0,r.jsx)(n.th,{children:"Title"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Required/Default"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/aws_access_key_id"})})}),(0,r.jsx)(n.td,{children:"AWS Access Key ID"}),(0,r.jsx)(n.td,{children:"Access Key ID for accessing AWS services."}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/aws_secret_access_key"})})}),(0,r.jsx)(n.td,{children:"AWS Secret Access key"}),(0,r.jsx)(n.td,{children:"Secret Access Key for accessing AWS services."}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/bucket"})})}),(0,r.jsx)(n.td,{children:"Bucket"}),(0,r.jsx)(n.td,{children:"The S3 bucket to write data files to."}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/prefix"})}),(0,r.jsx)(n.td,{children:"Prefix"}),(0,r.jsx)(n.td,{children:"Optional prefix that will be used to store objects."}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/region"})})}),(0,r.jsx)(n.td,{children:"Region"}),(0,r.jsx)(n.td,{children:"AWS Region."}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/namespace"})})}),(0,r.jsx)(n.td,{children:"Namespace"}),(0,r.jsx)(n.td,{children:"Namespace for bound collection tables (unless overridden within the binding resource configuration)."}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/upload_interval"})}),(0,r.jsx)(n.td,{children:"Upload Interval"}),(0,r.jsx)(n.td,{children:"Frequency at which files will be uploaded. Must be a valid ISO8601 duration string no greater than 4 hours."}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"PT5M"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/catalog/catalog_type"})})}),(0,r.jsx)(n.td,{children:"Catalog Type"}),(0,r.jsx)(n.td,{children:'Either "Iceberg REST Server" or "AWS Glue".'}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/catalog/uri"})})}),(0,r.jsx)(n.td,{children:"URI"}),(0,r.jsxs)(n.td,{children:["URI identifying the REST catalog, in the format of '",(0,r.jsx)(n.a,{href:"https://yourserver.com/catalog",children:"https://yourserver.com/catalog"}),"'."]}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/catalog/credential"})}),(0,r.jsx)(n.td,{children:"Credential"}),(0,r.jsx)(n.td,{children:"Credential for connecting to the REST catalog."}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/catalog/token"})}),(0,r.jsx)(n.td,{children:"Token"}),(0,r.jsx)(n.td,{children:"Token for connecting to the TEST catalog."}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/catalog/warehouse"})})}),(0,r.jsx)(n.td,{children:"Warehouse"}),(0,r.jsx)(n.td,{children:"Warehouse to connect to in the REST catalog."}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"bindings",children:"Bindings"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Property"}),(0,r.jsx)(n.th,{children:"Title"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Required/Default"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/table"})})}),(0,r.jsx)(n.td,{children:"Table"}),(0,r.jsx)(n.td,{children:"Name of the database table."}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/namespace"})}),(0,r.jsx)(n.td,{children:"Alternative Namespace"}),(0,r.jsx)(n.td,{children:"Alternative namespace for this table (optional)."}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/delta_updates"})}),(0,r.jsx)(n.td,{children:"Delta Updates"}),(0,r.jsx)(n.td,{children:"Should updates to this table be done via delta updates. Currently this connector only supports delta updates."}),(0,r.jsx)(n.td,{children:"bool"}),(0,r.jsx)(n.td,{children:"true"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"sample",children:"Sample"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'materializations:\n  ${PREFIX}/${mat_name}:\n    endpoint:\n      connector:\n        image: "ghcr.io/estuary/materialize-s3-iceberg:dev"\n        config:\n          aws_access_key_id: <access_key_id>\n          aws_secret_access_key: <secret_access_key>\n          bucket: bucket\n          region: us-east-2\n          namespace: namespace\n          upload_interval: PT5M\n    bindings:\n      - resource:\n          table: ${COLLECTION_NAME}\n          delta_updates: true\n        source: ${PREFIX}/${COLLECTION_NAME}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"iceberg-column-types",children:"Iceberg Column Types"}),"\n",(0,r.jsxs)(n.p,{children:["Flow collection fields are written to Iceberg table columns based on the data type of the field.\nIceberg ",(0,r.jsx)(n.a,{href:"https://iceberg.apache.org/spec/#primitive-types",children:"V2 primitive type"})," columns are created\nfor these Flow collection fields:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Collection Field Data Type"}),(0,r.jsx)(n.th,{children:"Iceberg Column Type"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"array"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"string"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"object"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"string"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"boolean"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"boolean"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"integer"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"long"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"number"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"double"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"string"})," with ",(0,r.jsx)(n.code,{children:"{contentEncoding: base64}"})]}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"binary"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"string"})," with ",(0,r.jsx)(n.code,{children:"{format: date-time}"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"timestamptz"})," (with microsecond precision)"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"string"})," with ",(0,r.jsx)(n.code,{children:"{format: date}"})]}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"date"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"string"})," with ",(0,r.jsx)(n.code,{children:"{format: integer}"})]}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"long"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"string"})," with ",(0,r.jsx)(n.code,{children:"{format: number}"})]}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"double"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"string"})," (all others)"]}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"string"})})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["Flow collection fields with ",(0,r.jsx)(n.code,{children:"{type: string, format: time}"})," and ",(0,r.jsx)(n.code,{children:"{type: string, format: uuid}"})," are\nmaterialized as ",(0,r.jsx)(n.strong,{children:"string"})," columns rather than ",(0,r.jsx)(n.strong,{children:"time"})," and ",(0,r.jsx)(n.strong,{children:"uuid"})," columns for compatibility with\nApache Spark. ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"https://iceberg.apache.org/spec/#nested-types",children:"Nested types"})})," are not currently\nsupported."]}),"\n",(0,r.jsx)(n.h2,{id:"table-maintenance",children:"Table Maintenance"}),"\n",(0,r.jsxs)(n.p,{children:["To ensure optimal query performance, you should conduct ",(0,r.jsx)(n.a,{href:"https://iceberg.apache.org/docs/latest/maintenance/",children:"regular\nmaintenance"})," for your materialized tables since\nthe connector will not perform this maintenance automatically (support for automatic table\nmaintenance is planned)."]}),"\n",(0,r.jsxs)(n.p,{children:["If you're using the AWS Glue catalog, you can enable automatic data file compaction by following\n",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/lake-formation/latest/dg/data-compaction.html",children:"this guide"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"at-least-once-semantics",children:"At-Least-Once Semantics"}),"\n",(0,r.jsx)(n.p,{children:"In rare cases, it may be possible for documents from a source collection to be appended to a target\ntable more than once. Users of materialized tables should take this possibility into consideration\nwhen querying these tables."})]})}function x(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(j,{...e})}):j(e)}}}]);