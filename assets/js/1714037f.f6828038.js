"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[967],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>k});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=p(a),k=r,d=m["".concat(s,".").concat(k)]||m[k]||u[k]||o;return a?n.createElement(d,i(i({ref:t},c),{},{components:a})):n.createElement(d,i({ref:t},c))}));function k(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},5751:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const o={},i="Amazon S3 to Snowflake",l={unversionedId:"guides/system-specific-dataflows/s3-to-snowflake",id:"guides/system-specific-dataflows/s3-to-snowflake",title:"Amazon S3 to Snowflake",description:"This guide walks you through the process of creating an",source:"@site/docs/guides/system-specific-dataflows/s3-to-snowflake.md",sourceDirName:"guides/system-specific-dataflows",slug:"/guides/system-specific-dataflows/s3-to-snowflake",permalink:"/guides/system-specific-dataflows/s3-to-snowflake",draft:!1,editUrl:"https://github.com/estuary/flow/edit/master/site/docs/guides/system-specific-dataflows/s3-to-snowflake.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Google Firestore to Snowflake",permalink:"/guides/system-specific-dataflows/firestore-to-dwh"},next:{title:"Create a derivation with flowctl",permalink:"/guides/create-derivation"}},s={},p=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Introduction",id:"introduction",level:2},{value:"Capture from S3",id:"capture-from-s3",level:2},{value:"Materialize to Snowflake",id:"materialize-to-snowflake",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}],c={toc:p};function u(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"amazon-s3-to-snowflake"},"Amazon S3 to Snowflake"),(0,r.kt)("p",null,"This guide walks you through the process of creating an\nend-to-end real-time Data Flow from Amazon S3 to Snowflake using Estuary Flow."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"You'll need:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"(Recommended) understanding of the ",(0,r.kt)("a",{parentName:"p",href:"/concepts/#essential-concepts"},"basic Flow concepts"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Access to the ",(0,r.kt)("a",{parentName:"p",href:"http://dashboard.estuary.dev"},(0,r.kt)("strong",{parentName:"a"},"Flow web application"))," through an Estuary account.\nIf you don't have one, visit the web app to register for your free trial.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"An ",(0,r.kt)("strong",{parentName:"p"},"S3 bucket")," that contains the data you'd like to move to Snowflake."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"For public buckets, verify that the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html#access-control-resources-manage-permissions-basics"},"access policy")," allows anonymous reads.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"For buckets accessed by a user account, you'll need the AWS ",(0,r.kt)("strong",{parentName:"p"},"access key")," and ",(0,r.kt)("strong",{parentName:"p"},"secret access key")," for the user.\nSee the ",(0,r.kt)("a",{parentName:"p",href:"https://aws.amazon.com/blogs/security/wheres-my-secret-access-key/"},"AWS blog")," for help finding these credentials.")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"A Snowflake account with:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"A target ",(0,r.kt)("strong",{parentName:"p"},"database"),", ",(0,r.kt)("strong",{parentName:"p"},"schema"),", and virtual ",(0,r.kt)("strong",{parentName:"p"},"warehouse"),"; and a ",(0,r.kt)("strong",{parentName:"p"},"user")," with a ",(0,r.kt)("strong",{parentName:"p"},"role")," assigned that grants the appropriate access levels to these resources.\n",(0,r.kt)("a",{parentName:"p",href:"/reference/Connectors/materialization-connectors/Snowflake#setup"},"You can use a script to quickly create all of these items.")," Have these details on hand for setup with Flow.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The account identifier and host URL noted. ",(0,r.kt)("a",{parentName:"p",href:"https://docs.snowflake.com/en/user-guide/admin-account-identifier.html#where-are-account-identifiers-used"},"The URL is formatted using the account identifier"),". For example, you might have the account identifier ",(0,r.kt)("inlineCode",{parentName:"p"},"orgname-accountname.snowflakecomputing.com"),"."))))),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"In Estuary Flow, you create ",(0,r.kt)("strong",{parentName:"p"},"Data Flows")," to transfer data from ",(0,r.kt)("strong",{parentName:"p"},"source")," systems to ",(0,r.kt)("strong",{parentName:"p"},"destination")," systems in real time.\nIn this use case, your source is an Amazon S3 bucket and your destination is a Snowflake data warehouse."),(0,r.kt)("p",null,"After following this guide, you'll have a Data Flow that comprises:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A ",(0,r.kt)("strong",{parentName:"li"},"capture"),", which ingests data from S3"),(0,r.kt)("li",{parentName:"ul"},"A ",(0,r.kt)("strong",{parentName:"li"},"collection"),", a cloud-backed copy of that data in the Flow system"),(0,r.kt)("li",{parentName:"ul"},"A ",(0,r.kt)("strong",{parentName:"li"},"materialization"),", which pushes the data to Snowflake")),(0,r.kt)("p",null,"The capture and materialization rely on plug-in components called ",(0,r.kt)("strong",{parentName:"p"},"connectors"),".\nWe'll walk through how to configure the ",(0,r.kt)("a",{parentName:"p",href:"/reference/Connectors/capture-connectors/amazon-s3"},"S3")," and ",(0,r.kt)("a",{parentName:"p",href:"/reference/Connectors/materialization-connectors/Snowflake"},"Snowflake")," connectors to integrate these systems with Flow."),(0,r.kt)("h2",{id:"capture-from-s3"},"Capture from S3"),(0,r.kt)("p",null,"You'll first create a capture to connect to your S3 bucket, which will yield one or more Flow collections."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Go to the Flow web application at ",(0,r.kt)("a",{parentName:"p",href:"https://dashboard.estuary.dev/"},"dashboard.estuary.dev")," and sign in using the\ncredentials provided by your Estuary account manager.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click the ",(0,r.kt)("strong",{parentName:"p"},"Captures")," tab and choose ",(0,r.kt)("strong",{parentName:"p"},"New Capture"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click the ",(0,r.kt)("strong",{parentName:"p"},"Amazon S3")," tile."),(0,r.kt)("p",{parentName:"li"},"A form appears with the properties required for an S3 capture.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Type a name for your capture."),(0,r.kt)("p",{parentName:"li"},"Your capture name must begin with a ",(0,r.kt)("a",{parentName:"p",href:"/concepts/catalogs#namespace"},"prefix")," to which you ",(0,r.kt)("a",{parentName:"p",href:"/reference/authentication"},"have access"),"."),(0,r.kt)("p",{parentName:"li"},"Click inside the ",(0,r.kt)("strong",{parentName:"p"},"Name")," field to generate a drop-down menu of available prefixes, and select your prefix.\nAppend a unique capture name after the ",(0,r.kt)("inlineCode",{parentName:"p"},"/")," to create the full name, for example, ",(0,r.kt)("inlineCode",{parentName:"p"},"acmeCo/myS3Capture"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Fill out the required properties for S3."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://aws.amazon.com/blogs/security/wheres-my-secret-access-key/"},(0,r.kt)("strong",{parentName:"a"},"AWS Access Key ID")," and ",(0,r.kt)("strong",{parentName:"a"},"AWS Secret Access Key")),": Required for private buckets.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"AWS Region")," and ",(0,r.kt)("strong",{parentName:"p"},"Bucket"),": These are listed in your ",(0,r.kt)("a",{parentName:"p",href:"https://s3.console.aws.amazon.com/s3/buckets"},"S3 console"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Prefix"),": You might organize your S3 bucket using ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/using-prefixes.html"},"prefixes"),", which emulate a directory structure. To capture ",(0,r.kt)("em",{parentName:"p"},"only")," from a specific prefix, add it here.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Match Keys"),": Filters to apply to the objects in the S3 bucket. If provided, only data whose absolute path matches the filter will be captured. For example, ",(0,r.kt)("inlineCode",{parentName:"p"},"*\\.json")," will only capture JSON file."))),(0,r.kt)("p",{parentName:"li"},"See the S3 connector documentation for information on ",(0,r.kt)("a",{parentName:"p",href:"/reference/Connectors/capture-connectors/amazon-s3#endpoint"},"advanced fields")," and ",(0,r.kt)("a",{parentName:"p",href:"/reference/Connectors/capture-connectors/amazon-s3#advanced-parsing-cloud-storage-data"},"parser settings"),". (You're unlikely to need these for most use cases.)")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click ",(0,r.kt)("strong",{parentName:"p"},"Next"),"."),(0,r.kt)("p",{parentName:"li"},"Flow uses the provided configuration to initiate a connection to S3."),(0,r.kt)("p",{parentName:"li"},"It generates a capture specification and details of the collection that it will create, once published."),(0,r.kt)("p",{parentName:"li"},"You can change the collection name in the ",(0,r.kt)("strong",{parentName:"p"},"Collection Selector"),", or edit the JSON in the ",(0,r.kt)("strong",{parentName:"p"},"Specification Editor")," directly."),(0,r.kt)("div",{parentName:"li",className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If you'd rather work on the specification files in their native YAML format, you can use the ",(0,r.kt)("a",{parentName:"p",href:"/concepts/flowctl"},"flowctl")," CLI. flowctl provides a developer-focused path to build full Data Flows in your preferred development environment."),(0,r.kt)("p",{parentName:"div"},"flowctl also offers access to advanced features \u2014 with S3, for instance, you can ",(0,r.kt)("a",{parentName:"p",href:"/reference/Connectors/capture-connectors/amazon-s3#configuration"},"map multiple prefixes to different collections within a single capture"),".")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click ",(0,r.kt)("strong",{parentName:"p"},"Save and publish"),"."),(0,r.kt)("p",{parentName:"li"},"You'll see a notification when the capture publishes successfully."),(0,r.kt)("p",{parentName:"li"},"The data currently in your S3 bucket has been captured, and future updates to it will be captured continuously.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click ",(0,r.kt)("strong",{parentName:"p"},"Materialize Collections")," to continue."))),(0,r.kt)("h2",{id:"materialize-to-snowflake"},"Materialize to Snowflake"),(0,r.kt)("p",null,"Next, you'll add a Snowflake materialization to connect the captured data to its destination: your data warehouse."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"On the ",(0,r.kt)("strong",{parentName:"p"},"Create Materialization")," page, search for and select the ",(0,r.kt)("strong",{parentName:"p"},"Snowflake")," tile."),(0,r.kt)("p",{parentName:"li"},"A form appears with the properties required for a Snowflake materialization.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Choose a unique name for your materialization like you did when naming your capture; for example, ",(0,r.kt)("inlineCode",{parentName:"p"},"acmeCo/mySnowflakeMaterialization"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Fill out the required properties for Snowflake (you should have most of these handy from the ",(0,r.kt)("a",{parentName:"p",href:"#prerequisites"},"prerequisites"),")."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Host URL")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Account")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"User")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Password")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Database")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Schema")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Warehouse"),": optional"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Role"),": optional"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Scroll down to view the ",(0,r.kt)("strong",{parentName:"p"},"Collection Selector")," and fill in the ",(0,r.kt)("strong",{parentName:"p"},"Table")," field."),(0,r.kt)("p",{parentName:"li"},"The collection you just created is already selected, but you must provide a name for the table to which it'll be materialized in Snowflake.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Choose whether to ",(0,r.kt)("a",{parentName:"p",href:"/reference/Connectors/materialization-connectors/Snowflake#delta-updates"},"enable delta updates"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click ",(0,r.kt)("strong",{parentName:"p"},"Next"),"."),(0,r.kt)("p",{parentName:"li"},"Flow uses the provided configuration to initiate a connection to Snowflake. It generates a materialization specification."),(0,r.kt)("p",{parentName:"li"},"You'll be notified if there's an error. In that case, fix the configuration form or Snowflake setup as needed and click ",(0,r.kt)("strong",{parentName:"p"},"Next")," to try again.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click ",(0,r.kt)("strong",{parentName:"p"},"Save and Publish"),". You'll see a notification when the full Data Flow publishes successfully."))),(0,r.kt)("h2",{id:"whats-next"},"What's next?"),(0,r.kt)("p",null,"Your Data Flow has been deployed, and will run continuously until it's stopped. Updates in your S3 bucket will be reflected in your Snowflake table as they occur."),(0,r.kt)("p",null,"You can advance your Data Flow by adding a ",(0,r.kt)("strong",{parentName:"p"},"derivation"),". Derivations are real-time data transformations.\nSee the ",(0,r.kt)("a",{parentName:"p",href:"/guides/create-derivation"},"guide to create a derivation"),"."))}u.isMDXComponent=!0}}]);