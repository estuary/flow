"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[4787],{17841:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"guides/customize-materialization-fields","title":"Customize Materialized Fields","description":"Estuary Flow can auto-discover data resources and schemas, and implements a priority-based system that intelligently selects fields to materialize.","source":"@site/docs/guides/customize-materialization-fields.md","sourceDirName":"guides","slug":"/guides/customize-materialization-fields","permalink":"/guides/customize-materialization-fields","draft":false,"unlisted":false,"editUrl":"https://github.com/estuary/flow/edit/master/site/docs/guides/customize-materialization-fields.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Secure connections","permalink":"/guides/connect-network"},"next":{"title":"dbt Cloud Integration","permalink":"/guides/dbt-integration"}}');var s=n(74848),l=n(28453);const o={},r="Customize Materialized Fields",c={},d=[{value:"Capture desired fields and generate projections",id:"capture-desired-fields-and-generate-projections",level:2},{value:"Captured collections",id:"captured-collections",level:3},{value:"Derived collections",id:"derived-collections",level:3},{value:"Field selection for materializations",id:"field-selection-for-materializations",level:2}];function a(e){const i={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.header,{children:(0,s.jsx)(i.h1,{id:"customize-materialized-fields",children:"Customize Materialized Fields"})}),"\n",(0,s.jsx)(i.p,{children:"Estuary Flow can auto-discover data resources and schemas, and implements a priority-based system that intelligently selects fields to materialize.\nHowever, you may wish to override these defaults to customize the final format of your materialized tables.\nFor example, columns you require may be missing or may need specific names to work with downstream systems.\nOr you might wish to keep columns with sensitive data from materializing entirely."}),"\n",(0,s.jsx)(i.p,{children:"This happens when the collection's JSON schema doesn't map to a table schema appropriate for your use case."}),"\n",(0,s.jsx)(i.p,{children:"You can control the shape and appearance of materialized tables using a two-step process."}),"\n",(0,s.jsxs)(i.p,{children:["First, you modify the source collection ",(0,s.jsx)(i.strong,{children:"schema"}),".\nYou can change column names by adding ",(0,s.jsx)(i.strong,{children:(0,s.jsx)(i.a,{href:"/concepts/advanced/projections",children:"projections"})}),":\nJSON pointers that turn locations in a document's JSON structure into custom named fields."]}),"\n",(0,s.jsxs)(i.p,{children:["Then, you add the ",(0,s.jsx)(i.code,{children:"fields"})," stanza to the materialization specification, telling Flow which fields to materialize."]}),"\n",(0,s.jsx)(i.p,{children:"You can manage both of these options through Estuary's dashboard or modify them directly in the resource specification file."}),"\n",(0,s.jsx)(i.p,{children:"The following sections break down the process in more detail."}),"\n",(0,s.jsx)(i.admonition,{title:"Hint",type:"info",children:(0,s.jsxs)(i.p,{children:["If you just need to add a field that isn't included by default and it's already present in the schema\nwith a name you like, skip ahead to ",(0,s.jsx)(i.a,{href:"#field-selection-for-materializations",children:"include desired fields in your materialization"}),"."]})}),"\n",(0,s.jsx)(i.h2,{id:"capture-desired-fields-and-generate-projections",children:"Capture desired fields and generate projections"}),"\n",(0,s.jsxs)(i.p,{children:["Any field you eventually want to materialize must be included in the collection's schema.\nIt's ok if the field is nested in the JSON structure; you'll flatten the structure with ",(0,s.jsx)(i.strong,{children:"projections"}),"."]}),"\n",(0,s.jsx)(i.admonition,{type:"caution",children:(0,s.jsx)(i.p,{children:"In this workflow, you'll edit a collection. This change can impact other downstream materializations and derivations.\nUse caution and be mindful of any edit's consequences before publishing."})}),"\n",(0,s.jsx)(i.h3,{id:"captured-collections",children:"Captured collections"}),"\n",(0,s.jsx)(i.p,{children:"If the collection you're using was captured directly, follow these steps."}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Go to the ",(0,s.jsx)(i.a,{href:"https://dashboard.estuary.dev/captures",children:"Captures"})," page of the Flow web app\nand locate the capture that produced the collection."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Select your capture and click the ",(0,s.jsx)(i.strong,{children:"Edit"})," button."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Under ",(0,s.jsx)(i.strong,{children:"Target Collections"}),", choose the binding that corresponds to the collection.\nThen, click the ",(0,s.jsx)(i.strong,{children:"Collection"})," tab."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["In the list of fields, look for the fields you want to materialize.\nIf they're present and correctly named, you can skip to\n",(0,s.jsx)(i.a,{href:"#field-selection-for-materializations",children:"including them in the materialization"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.admonition,{title:"hint",type:"info",children:(0,s.jsx)(i.p,{children:"Compare the field name and pointer.\nFor nested pointers, you'll probably want to change the field name to omit slashes."})}),"\n",(0,s.jsxs)(i.ol,{start:"5",children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"If you need to change your fields, you can edit the collection schema."}),"\n",(0,s.jsx)(i.p,{children:"If your desired fields aren't present and your capture does not automatically keep schemas up to date, you can edit the schema directly:"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Click ",(0,s.jsx)(i.strong,{children:"Edit"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Add missing fields to the schema in the correct location based on the source data structure."}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Click ",(0,s.jsx)(i.strong,{children:"Close"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"If you simply want to rename existing fields, you can provide alternate names for individual fields:"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["In the Schema table, click the ",(0,s.jsx)(i.strong,{children:"Rename"})," button for the field you wish to change."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["In the ",(0,s.jsx)(i.strong,{children:"Alternate Name"})," modal, provide the field's ",(0,s.jsx)(i.strong,{children:"New Name"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Click ",(0,s.jsx)(i.strong,{children:"Apply"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Repeat steps 3 through 5 with other collections, if necessary."}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["You can ",(0,s.jsx)(i.a,{href:"/reference/backfilling-data",children:"backfill"})," affected collections to ensure historical data is populated with your new projections."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Click ",(0,s.jsx)(i.strong,{children:"Save and Publish"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.admonition,{type:"info",children:(0,s.jsxs)(i.p,{children:["You can also add projections manually with ",(0,s.jsx)(i.code,{children:"flowctl"}),".\nRefer to the guide to ",(0,s.jsx)(i.a,{href:"/guides/flowctl/edit-specification-locally",children:"editing with flowctl"})," and\n",(0,s.jsx)(i.a,{href:"/concepts/collections#projections",children:"how to format projections"}),"."]})}),"\n",(0,s.jsx)(i.h3,{id:"derived-collections",children:"Derived collections"}),"\n",(0,s.jsx)(i.p,{children:"If the collection you're using came from a derivation, follow these steps."}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.a,{href:"/guides/flowctl/edit-specification-locally#pull-specifications-locally",children:"Pull the derived collection's specification locally"})," using ",(0,s.jsx)(i.code,{children:"flowctl"}),"."]}),"\n"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"flowctl catalog pull-specs --name <yourOrg/full/collectionName>\n"})}),"\n",(0,s.jsxs)(i.ol,{start:"2",children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Review the collection's schema to see if the fields of interest are included. If they're present, you can skip to\n",(0,s.jsx)(i.a,{href:"#field-selection-for-materializations",children:"including them in the materialization"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"If your desired fields aren't present or are incorrectly named, add any missing fields to the schema in the correct location based on the source data structure."}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Use schema inference to generate projections for the fields."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"flowctl preview --infer-schema --source <full\\path\\to\\flow.yaml> --collection <yourOrg/full/collectionName>\n"})}),"\n",(0,s.jsxs)(i.ol,{start:"5",children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Review the updated schema. Manually change the names of projected fields. These names will be used by the materialization and shown in the endpoint system as column names or the equivalent."}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.a,{href:"/guides/flowctl/edit-specification-locally#edit-source-files-and-re-publish-specifications",children:"Re-publish the collection specification"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"field-selection-for-materializations",children:"Field selection for materializations"}),"\n",(0,s.jsx)(i.p,{children:"Now that all your fields are present in the collection schema as projections,\nyou can choose which ones to include in the materialization."}),"\n",(0,s.jsx)(i.p,{children:"Estuary automatically detects fields and uses a priority-based selection system to determine the fields to include or exclude in the materialization."}),"\n",(0,s.jsx)(i.p,{children:"This means that, for each field, a stronger selection reason will override a weaker rejection reason, and vice versa.\nThis helps ensure that critical fields get materialized."}),"\n",(0,s.jsx)(i.p,{children:"Every included field will be mapped to a table column or equivalent in the endpoint system."}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["If you haven't created the materialization, ",(0,s.jsx)(i.a,{href:"/guides/create-dataflow#create-a-materialization",children:"begin the process"}),". Pause once you've selected the collections to materialize."]}),"\n",(0,s.jsxs)(i.p,{children:["If your materialization already exists, navigate to the ",(0,s.jsx)(i.a,{href:"/guides/edit-data-flows#edit-a-materialization",children:"edit materialization"})," page."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"In the Collection Selector, choose the collection whose output fields you want to change."}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["In the ",(0,s.jsx)(i.strong,{children:"Config"})," tab, scroll down to the ",(0,s.jsx)(i.strong,{children:"Field Selection"})," table."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Review the listed fields in the field selection table."}),"\n",(0,s.jsxs)(i.p,{children:["Estuary checks each field against a number of selection and rejection criteria to inform the default materialized fields.\nYou can customize this behavior further with ",(0,s.jsx)(i.strong,{children:"modes"})," and individual ",(0,s.jsx)(i.strong,{children:"field overrides"}),"."]}),"\n",(0,s.jsxs)(i.p,{children:["The field selection table will provide an ",(0,s.jsx)(i.strong,{children:"Outcome"})," for each field:"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Field included"}),": The field will be included in the materialization. Symbolized by a filled bookmark."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Field excluded"}),": The field will not be included in the materialization. Symbolized by an empty bookmark."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Conflict"}),": The field matches criteria for both selection and rejection.\nSymbolized by a warning sign. The outcome tooltip provides detailed information on the conflict."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Choose whether to start with one of Flow's field selection ",(0,s.jsx)(i.strong,{children:"modes"}),". You can customize individual fields later. Modes include and exclude fields based on field depth:"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Depth Zero:"})," Only selects top-level fields"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Depth One:"})," Selects object fields with one degree of nesting"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Depth Two:"})," Selects object fields with two degrees of nesting"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Unlimited Depth:"})," Selects all fields"]}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:["Selecting a depth limit can help prevent over-materializing complex document structures.\nIf you don't select a mode, Estuary will default to ",(0,s.jsx)(i.strong,{children:"Depth One"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["You can modify individual fields by choosing to ",(0,s.jsx)(i.strong,{children:"require"})," or ",(0,s.jsx)(i.strong,{children:"exclude"})," them."]}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.img,{alt:"Field selection modes and individual options",src:n(48539).A+"",width:"1236",height:"322"})}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Repeat steps 2 through 5 with other collections, if necessary."}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Click ",(0,s.jsx)(i.strong,{children:"Save and Publish"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"The named, included fields will be reflected in the endpoint system."})]})}function h(e={}){const{wrapper:i}={...(0,l.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},28453:(e,i,n)=>{n.d(i,{R:()=>o,x:()=>r});var t=n(96540);const s={},l=t.createContext(s);function o(e){const i=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function r(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(l.Provider,{value:i},e.children)}},48539:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/field-selection-0772918d5f6216618155fd532cb6b569.png"}}]);