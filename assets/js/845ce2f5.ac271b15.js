"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[9917],{28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>i});var r=s(96540);const t={},a=r.createContext(t);function o(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(a.Provider,{value:n},e.children)}},83474:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"reference/Connectors/capture-connectors/SQLServer/sqlserver","title":"Microsoft SQL Server","description":"This connector uses change data capture (CDC) to continuously capture updates in a Microsoft SQL Server database into one or more Flow collections.","source":"@site/docs/reference/Connectors/capture-connectors/SQLServer/sqlserver.md","sourceDirName":"reference/Connectors/capture-connectors/SQLServer","slug":"/reference/Connectors/capture-connectors/SQLServer/","permalink":"/reference/Connectors/capture-connectors/SQLServer/","draft":false,"unlisted":false,"editUrl":"https://github.com/estuary/flow/edit/master/site/docs/reference/Connectors/capture-connectors/SQLServer/sqlserver.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Marketo","permalink":"/reference/Connectors/capture-connectors/marketo"},"next":{"title":"Amazon RDS for SQL Server","permalink":"/reference/Connectors/capture-connectors/SQLServer/amazon-rds-sqlserver"}}');var t=s(74848),a=s(28453);const o={sidebar_position:3},i="Microsoft SQL Server",l={},c=[{value:"Supported versions and platforms",id:"supported-versions-and-platforms",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Setup",id:"setup",level:2},{value:"Self-hosted SQL Server",id:"self-hosted-sql-server",level:3},{value:"Azure SQL Database",id:"azure-sql-database",level:3},{value:"Handling DDL Alterations to Source Tables",id:"handling-ddl-alterations-to-source-tables",level:3},{value:"Automatic Capture Instance Management",id:"automatic-capture-instance-management",level:3},{value:"Automatic Change Table Cleanup",id:"automatic-change-table-cleanup",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Properties",id:"properties",level:3},{value:"Endpoint",id:"endpoint",level:4},{value:"Bindings",id:"bindings",level:4},{value:"Sample",id:"sample",level:3},{value:"Specifying Flow collection keys",id:"specifying-flow-collection-keys",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"microsoft-sql-server",children:"Microsoft SQL Server"})}),"\n",(0,t.jsx)(n.p,{children:"This connector uses change data capture (CDC) to continuously capture updates in a Microsoft SQL Server database into one or more Flow collections."}),"\n",(0,t.jsxs)(n.p,{children:["It\u2019s available for use in the Flow web application. For local development or open-source workflows, ",(0,t.jsx)(n.a,{href:"https://ghcr.io/estuary/source-sqlserver:dev",children:(0,t.jsx)(n.code,{children:"ghcr.io/estuary/source-sqlserver:dev"})})," provides the latest version of the connector as a Docker image. You can also follow the link in your browser to see past image versions."]}),"\n",(0,t.jsx)(n.h2,{id:"supported-versions-and-platforms",children:"Supported versions and platforms"}),"\n",(0,t.jsx)(n.p,{children:"This connector will work on both hosted deployments and all major cloud providers. It is designed for databases using any version of SQL Server which has CDC support, and is regularly tested against SQL Server 2017 and up."}),"\n",(0,t.jsx)(n.p,{children:"Setup instructions are provided for the following platforms:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#self-hosted-sql-server",children:"Self-hosted SQL Server"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#azure-sql-database",children:"Azure SQL Database"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"./amazon-rds-sqlserver/",children:"Amazon RDS for SQL Server"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"./google-cloud-sql-sqlserver/",children:"Google Cloud SQL for SQL Server"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(n.p,{children:"To capture change events from SQL Server tables using this connector, you need:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["For each table to be captured, a primary key should be specified in the database.\nIf a table doesn't have a primary key, you must manually specify a key in the associated Flow collection definition while creating the capture.\n",(0,t.jsx)(n.a,{href:"#specifying-flow-collection-keys",children:"See detailed steps"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/sql/relational-databases/track-changes/enable-and-disable-change-data-capture-sql-server?view=sql-server-ver16",children:"CDC enabled"}),"\non both the database and the individual tables to be captured."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Enabling CDC on a source table create a ",(0,t.jsx)(n.em,{children:"change table"}),' in the database, from which the connector reads. You may optionally enable the "Automatic Capture Instance Management" advanced option to have the connector manage these automatically, but this will require additional permissions. See ',(0,t.jsx)(n.a,{href:"#automatic-capture-instance-management",children:"Automatic Capture Instance Management"})," for more details."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"A user role with:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"VIEW DATABASE STATE"})," or (in newer versions of SQL Server) ",(0,t.jsx)(n.code,{children:"VIEW DATABASE PERFORMANCE STATE"})," permission."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"SELECT"})," permissions on the CDC schema and the schemas that contain tables to be captured."]}),"\n",(0,t.jsx)(n.li,{children:"Access to the change tables created as part of the SQL Server CDC process."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,t.jsx)(n.p,{children:"To meet these requirements, follow the steps for your hosting type."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#self-hosted-sql-server",children:"Self-hosted SQL Server"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#azure-sql-database",children:"Azure SQL Database"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"./amazon-rds-sqlserver/",children:"Amazon RDS for SQL Server"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"./google-cloud-sql-sqlserver/",children:"Google Cloud SQL for SQL Server"})}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"self-hosted-sql-server",children:"Self-hosted SQL Server"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Connect to the server and issue the following commands:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"USE <database>;\n-- Enable CDC for the database.\nEXEC sys.sp_cdc_enable_db;\n-- Create user and password for use with the connector.\nCREATE LOGIN flow_capture WITH PASSWORD = 'secret';\nCREATE USER flow_capture FOR LOGIN flow_capture;\n-- Grant the user permissions on the CDC schema and schemas with data.\n-- This assumes all tables to be captured are in the default schema, `dbo`.\n-- Add similar queries for any other schemas that contain tables you want to capture.\nGRANT SELECT ON SCHEMA :: dbo TO flow_capture;\nGRANT SELECT ON SCHEMA :: cdc TO flow_capture;\n-- Grant the 'VIEW DATABASE STATE' permission.\nGRANT VIEW DATABASE STATE TO flow_capture;\n-- Enable CDC on tables. The below query enables CDC on table 'dbo.foobar',\n-- you should add similar query for all other tables you intend to capture.\nEXEC sys.sp_cdc_enable_table @source_schema = 'dbo', @source_name = 'foobar', @role_name = 'flow_capture';\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Allow secure connection to Estuary Flow from your hosting environment. Either:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Set up an ",(0,t.jsx)(n.a,{href:"/guides/connect-network/",children:"SSH server for tunneling"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["When you fill out the ",(0,t.jsx)(n.a,{href:"#endpoint",children:"endpoint configuration"}),",\ninclude the additional ",(0,t.jsx)(n.code,{children:"networkTunnel"})," configuration to enable the SSH tunnel.\nSee ",(0,t.jsx)(n.a,{href:"/concepts/connectors#connecting-to-endpoints-on-secure-networks",children:"Connecting to endpoints on secure networks"}),"\nfor additional details and a sample."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"/reference/allow-ip-addresses",children:"Allowlist the Estuary IP addresses"})," in your firewall rules."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"azure-sql-database",children:"Azure SQL Database"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Allow connections between the database and Estuary Flow. There are two ways to do this: by granting direct access to Flow's IP or by creating an SSH tunnel."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"To allow direct access:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Create a new ",(0,t.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/azure-sql/database/firewall-configure?view=azuresql#use-the-azure-portal-to-manage-server-level-ip-firewall-rules",children:"firewall rule"})," that grants access to the ",(0,t.jsx)(n.a,{href:"/reference/allow-ip-addresses",children:"Estuary Flow IP addresses"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"To allow secure connections via SSH tunneling:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Follow the guide to ",(0,t.jsx)(n.a,{href:"/guides/connect-network/",children:"configure an SSH server for tunneling"})]}),"\n",(0,t.jsxs)(n.li,{children:["When you configure your connector as described in the ",(0,t.jsx)(n.a,{href:"#configuration",children:"configuration"})," section above, including the additional ",(0,t.jsx)(n.code,{children:"networkTunnel"})," configuration to enable the SSH tunnel. See ",(0,t.jsx)(n.a,{href:"/concepts/connectors#connecting-to-endpoints-on-secure-networks",children:"Connecting to endpoints on secure networks"})," for additional details and a sample."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["In your SQL client, connect to your instance as the default ",(0,t.jsx)(n.code,{children:"sqlserver"})," user and issue the following commands."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"USE <database>;\n-- Enable CDC for the database.\nEXEC sys.sp_cdc_enable_db;\n-- Create user and password for use with the connector.\nCREATE LOGIN flow_capture WITH PASSWORD = 'secret';\nCREATE USER flow_capture FOR LOGIN flow_capture;\n-- Grant the user permissions on the CDC schema and schemas with data.\n-- This assumes all tables to be captured are in the default schema, `dbo`.\n-- Add similar queries for any other schemas that contain tables you want to capture.\nGRANT SELECT ON SCHEMA :: dbo TO flow_capture;\nGRANT SELECT ON SCHEMA :: cdc TO flow_capture;\n-- Grant the 'VIEW DATABASE STATE' permission.\nGRANT VIEW DATABASE STATE TO flow_capture;\n-- Enable CDC on tables. The below query enables CDC on table 'dbo.foobar',\n-- you should add similar query for all other tables you intend to capture.\nEXEC sys.sp_cdc_enable_table @source_schema = 'dbo', @source_name = 'foobar', @role_name = 'flow_capture';\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Note the following important items for configuration:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Find the instance's host under Server Name. The port is always ",(0,t.jsx)(n.code,{children:"1433"}),". Together, you'll use the host",":port"," as the ",(0,t.jsx)(n.code,{children:"address"})," property when you configure the connector."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"handling-ddl-alterations-to-source-tables",children:"Handling DDL Alterations to Source Tables"}),"\n",(0,t.jsxs)(n.p,{children:["In SQL Server, adding a column to the source table will not automatically cause it to be added to the CDC change table. Instead ",(0,t.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/sql/relational-databases/track-changes/about-change-data-capture-sql-server?view=sql-server-ver17#handling-changes-to-source-table",children:"Microsoft's recommended approach"})," is to create a second capture instance which reflects the new state of the source table, transition over to the new instance, and then delete the old one."]}),"\n",(0,t.jsx)(n.p,{children:"The connector will automatically detect the existence of a second capture instance and will seamlessly switch over to the newest one as soon as it reaches a point in the event stream where they are both valid. After this switchover occurs you may delete the old instance."}),"\n",(0,t.jsxs)(n.p,{children:["If you are managing capture instances manually, you will need to manually create the new instance with ",(0,t.jsx)(n.code,{children:"sys.sp_cdc_enable_table"}),", wait for the new column to begin being captured, and then delete the old instance at your leisure using ",(0,t.jsx)(n.code,{children:"sys.sp_cdc_disable_table"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["If you are using ",(0,t.jsx)(n.a,{href:"#automatic-capture-instance-management",children:"Automatic Capture Instance Management"}),", the connector detect DDL alterations to the source table and will handle the whole process of creating a new CDC instance and dropping the old one automatically."]}),"\n",(0,t.jsx)(n.h3,{id:"automatic-capture-instance-management",children:"Automatic Capture Instance Management"}),"\n",(0,t.jsxs)(n.p,{children:["You may wish to have the connector automatically issue ",(0,t.jsx)(n.code,{children:"sys.sp_cdc_enable_table"})," (and sometimes also ",(0,t.jsx)(n.code,{children:"sys.sp_cdc_disable_table"}),") statements on your behalf. This can be done by enabling the option ",(0,t.jsx)(n.code,{children:"Advanced > Automatic Capture Instance Management"})," and granting the required permission if necessary."]}),"\n",(0,t.jsxs)(n.p,{children:["Unfortunately, the ",(0,t.jsx)(n.code,{children:"sys.sp_cdc_enable_table"})," stored procedure ",(0,t.jsxs)(n.a,{href:"https://learn.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-table-transact-sql?view=sql-server-ver17#permissions",children:["requires membership in the ",(0,t.jsx)(n.code,{children:"db_owner"})," database role"]})," to call."]}),"\n",(0,t.jsxs)(n.p,{children:["Granting that permission to the capture user is a hard requirement for using this feature, and can be done by executing ",(0,t.jsx)(n.code,{children:"ALTER ROLE db_owner ADD MEMBER <user>"})," on the source database."]}),"\n",(0,t.jsx)(n.h3,{id:"automatic-change-table-cleanup",children:"Automatic Change Table Cleanup"}),"\n",(0,t.jsxs)(n.p,{children:["By default, CDC change tables will retain change events for ",(0,t.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql?view=sql-server-ver17#----retention",children:"three days"}),". This can be modified via ",(0,t.jsx)(n.code,{children:"sys.sp_cdc_change_job"}),", but a lower retention period can put you at a higher risk of losing change events in the event of downtime, if the issue persists long enough for unconsumed change events to expire. If this happens a complete backfill will be required to re-establish consistency."]}),"\n",(0,t.jsxs)(n.p,{children:["An alternative solution is to enable the option ",(0,t.jsx)(n.code,{children:"Advanced > Automatic Change Table Cleanup"}),". When this option is enabled, the connector will manually remove change events from the relevant change tables once it receives confirmation that they have been durably persisted into a Flow collection."]}),"\n",(0,t.jsxs)(n.p,{children:["Unfortunately, the ",(0,t.jsx)(n.code,{children:"sys.sp_cdc_cleanup_change_table"})," stored procedure used to delete CDC events from the change table ",(0,t.jsxs)(n.a,{href:"https://learn.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sys-sp-cdc-cleanup-change-table-transact-sql?view=sql-server-ver17#permissions",children:["requires membership in the ",(0,t.jsx)(n.code,{children:"db_owner"})," database role"]})," to call."]}),"\n",(0,t.jsxs)(n.p,{children:["Granting that permission to the capture user is a hard requirement for using this feature, and can be done by executing ",(0,t.jsx)(n.code,{children:"ALTER ROLE db_owner ADD MEMBER <user>"})," on the source database."]}),"\n",(0,t.jsxs)(n.p,{children:["Note also that you still need to have enough free storage space to hold the full 3 days of CDC event retention in the worst case. Otherwise, in the event of downtime exceeding what you can store, you have only changed the failure mode to running out of disk space. This option is best used in situations where it is ",(0,t.jsx)(n.em,{children:"possible"})," to use that much storage but it is still undesirable for other reasons to use that much in normal operation, such as when using flexible storage volumes on a cloud host."]}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["You configure connectors either in the Flow web app, or by directly editing the catalog specification file.\nSee ",(0,t.jsx)(n.a,{href:"/concepts/connectors#using-connectors",children:"connectors"})," to learn more about using connectors. The values and specification sample below provide configuration details specific to the SQL Server source connector."]}),"\n",(0,t.jsx)(n.h3,{id:"properties",children:"Properties"}),"\n",(0,t.jsx)(n.h4,{id:"endpoint",children:"Endpoint"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Property"}),(0,t.jsx)(n.th,{children:"Title"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Required/Default"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"/address"})})}),(0,t.jsx)(n.td,{children:"Server Address"}),(0,t.jsxs)(n.td,{children:["The host or host",":port"," at which the database can be reached."]}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Required"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"/database"})})}),(0,t.jsx)(n.td,{children:"Database"}),(0,t.jsx)(n.td,{children:"Logical database name to capture from."}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Required"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"/user"})})}),(0,t.jsx)(n.td,{children:"User"}),(0,t.jsx)(n.td,{children:"The database user to authenticate as."}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsxs)(n.td,{children:["Required, ",(0,t.jsx)(n.code,{children:'"flow_capture"'})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"/password"})})}),(0,t.jsx)(n.td,{children:"Password"}),(0,t.jsx)(n.td,{children:"Password for the specified database user."}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Required"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/advanced"})}),(0,t.jsx)(n.td,{children:"Advanced Options"}),(0,t.jsx)(n.td,{children:"Options for advanced users. You should not typically need to modify these."}),(0,t.jsx)(n.td,{children:"object"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/advanced/backfill_chunk_size"})}),(0,t.jsx)(n.td,{children:"Backfill Chunk Size"}),(0,t.jsx)(n.td,{children:"The number of rows which should be fetched from the database in a single backfill query."}),(0,t.jsx)(n.td,{children:"integer"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"4096"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/advanced/skip_backfills"})}),(0,t.jsx)(n.td,{children:"Skip Backfills"}),(0,t.jsx)(n.td,{children:"A comma-separated list of fully-qualified table names which should not be backfilled."}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{})]})]})]}),"\n",(0,t.jsx)(n.h4,{id:"bindings",children:"Bindings"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Property"}),(0,t.jsx)(n.th,{children:"Title"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Required/Default"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"/namespace"})})}),(0,t.jsx)(n.td,{children:"Namespace"}),(0,t.jsxs)(n.td,{children:["The ",(0,t.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/sql/relational-databases/databases/databases?view=sql-server-ver16#basic-information-about-databases",children:"namespace/schema"})," of the table."]}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Required"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"/stream"})})}),(0,t.jsx)(n.td,{children:"Stream"}),(0,t.jsx)(n.td,{children:"Table name."}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Required"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/primary_key"})}),(0,t.jsx)(n.td,{children:"Primary Key Columns"}),(0,t.jsx)(n.td,{children:"array"}),(0,t.jsx)(n.td,{children:"The columns which together form the primary key of the table."}),(0,t.jsx)(n.td,{})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"sample",children:"Sample"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'captures:\n  ${PREFIX}/${CAPTURE_NAME}:\n    endpoint:\n      connector:\n        image: "ghcr.io/estuary/source-sqlserver:dev"\n        config:\n          address: "<host>:1433"\n          database: "my_db"\n          user: "flow_capture"\n          password: "secret"\n    bindings:\n      - resource:\n          stream: ${TABLE_NAME}\n          namespace: dbo\n          primary_key: ["id"]\n        target: ${PREFIX}/${COLLECTION_NAME}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Your capture definition will likely be more complex, with additional bindings for each table in the source database."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"/concepts/captures",children:"Learn more about capture definitions."})}),"\n",(0,t.jsx)(n.h2,{id:"specifying-flow-collection-keys",children:"Specifying Flow collection keys"}),"\n",(0,t.jsxs)(n.p,{children:["Every Flow collection must have a ",(0,t.jsx)(n.a,{href:"/concepts/collections#keys",children:"key"}),".\nAs long as your SQL Server tables have a primary key specified, the connector will set the\ncorresponding collection's key accordingly."]}),"\n",(0,t.jsxs)(n.p,{children:["In cases where a SQL Server table you want to capture doesn't have a primary key,\nyou can manually add it to the collection definition during the ",(0,t.jsx)(n.a,{href:"/guides/create-dataflow#create-a-capture",children:"capture creation workflow"}),"."]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["After you input the endpoint configuration and click ",(0,t.jsx)(n.strong,{children:"Next"}),",\nthe tables in your database have been mapped to Flow collections.\nClick each collection's ",(0,t.jsx)(n.strong,{children:"Specification"})," tab and identify a collection where ",(0,t.jsx)(n.code,{children:'"key": [ ],'})," is empty."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Click inside the empty key value in the editor and input the name of column in the table to use as the key, formatted as a JSON pointer. For example ",(0,t.jsx)(n.code,{children:'"key": ["/foo"],'})]}),"\n",(0,t.jsxs)(n.p,{children:["Make sure the key field is required, not nullable, and of an ",(0,t.jsx)(n.a,{href:"/concepts/collections#schema-restrictions",children:"allowed type"}),".\nMake any other necessary changes to the ",(0,t.jsx)(n.a,{href:"/concepts/collections#specification",children:"collection specification"})," to accommodate this."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Repeat with other missing collection keys, if necessary."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Save and publish the capture as usual."}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);