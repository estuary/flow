"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[3766],{584:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/tinybird-dekaf-connection-fba932bedbbcc4c576198ff245096769.png"},4106:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/tinybird-workspace-options-69ebcdebdf375c318edf61cb1a680be0.png"},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>d});var t=i(96540);const r={},s=t.createContext(r);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:n},e.children)}},53390:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"reference/Connectors/materialization-connectors/Dekaf/tinybird","title":"Tinybird","description":"This connector materializes Flow collections as Kafka-compatible messages that a Tinybird Kafka consumer can read. Tinybird is a data platform for user-facing analytics.","source":"@site/docs/reference/Connectors/materialization-connectors/Dekaf/tinybird.md","sourceDirName":"reference/Connectors/materialization-connectors/Dekaf","slug":"/reference/Connectors/materialization-connectors/Dekaf/tinybird","permalink":"/reference/Connectors/materialization-connectors/Dekaf/tinybird","draft":false,"unlisted":false,"editUrl":"https://github.com/estuary/flow/edit/master/site/docs/reference/Connectors/materialization-connectors/Dekaf/tinybird.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"StarTree","permalink":"/reference/Connectors/materialization-connectors/Dekaf/startree"},"next":{"title":"Elasticsearch","permalink":"/reference/Connectors/materialization-connectors/Elasticsearch"}}');var r=i(74848),s=i(28453);const o={},d="Tinybird",a={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Variants",id:"variants",level:2},{value:"Setup",id:"setup",level:2},{value:"Connecting Estuary Flow to Tinybird",id:"connecting-estuary-flow-to-tinybird",level:2},{value:"Forward workspaces",id:"forward-workspaces",level:3},{value:"Classic workspaces",id:"classic-workspaces",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Properties",id:"properties",level:3},{value:"Endpoint",id:"endpoint",level:4},{value:"Bindings",id:"bindings",level:4},{value:"Sample",id:"sample",level:3},{value:"Configuring support for deletions",id:"configuring-support-for-deletions",level:2},{value:"Soft deletes",id:"soft-deletes",level:3},{value:"Hard deletes",id:"hard-deletes",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"tinybird",children:"Tinybird"})}),"\n",(0,r.jsxs)(n.p,{children:["This connector materializes Flow collections as Kafka-compatible messages that a Tinybird Kafka consumer can read. ",(0,r.jsx)(n.a,{href:"https://www.tinybird.co/",children:"Tinybird"})," is a data platform for user-facing analytics."]}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.p,{children:"To use this connector, you'll need:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"At least one Flow collection"}),"\n",(0,r.jsx)(n.li,{children:"A Tinybird account"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"variants",children:"Variants"}),"\n",(0,r.jsxs)(n.p,{children:["This connector is a variant of the default Dekaf connector. For other integration options, see the main ",(0,r.jsx)(n.a,{href:"/reference/Connectors/materialization-connectors/Dekaf/",children:"Dekaf"})," page."]}),"\n",(0,r.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,r.jsx)(n.p,{children:"Provide an auth token when setting up the Dekaf connector. This can be a password of your choosing and will be used to authenticate consumers to your Kafka topics."}),"\n",(0,r.jsxs)(n.p,{children:["Once the connector is created, note the full materialization name, such as ",(0,r.jsx)(n.code,{children:"YOUR-ORG/YOUR-PREFIX/YOUR-MATERIALIZATION"}),". You will use this as the username."]}),"\n",(0,r.jsx)(n.h2,{id:"connecting-estuary-flow-to-tinybird",children:"Connecting Estuary Flow to Tinybird"}),"\n",(0,r.jsxs)(n.p,{children:["When you create a new workspace in Tinybird, you may be able to choose between ",(0,r.jsx)(n.a,{href:"#classic-workspaces",children:(0,r.jsx)(n.strong,{children:"Tinybird Classic"})})," and ",(0,r.jsx)(n.a,{href:"#forward-workspaces",children:(0,r.jsx)(n.strong,{children:"Tinybird Forward"})}),".\nClassic is based on UI configuration while Forward is based on CLI configuration, so each type of workspace requires different setup steps."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Creating a new Tinybird workspace",src:i(4106).A+"",width:"1224",height:"1171"})}),"\n",(0,r.jsx)(n.h3,{id:"forward-workspaces",children:"Forward workspaces"}),"\n",(0,r.jsx)(n.p,{children:"In a Tinybird Forward workspace, you will need to develop your project locally first before deploying it to Tinybird. Follow Tinybird's Quickstart prompts to get started with the CLI up through creating your project."}),"\n",(0,r.jsx)(n.p,{children:"Locally, you should have a directory structure with folders for all of your resources, such as connections and datasources."}),"\n",(0,r.jsxs)(n.p,{children:["In the ",(0,r.jsx)(n.code,{children:"connections"})," directory, modify the stub file or create a new ",(0,r.jsx)(n.code,{children:".connection"})," file. Add your Dekaf connection details here, following the structure below.\nNote that while the example uses plain text for clarity, you can use ",(0,r.jsx)(n.a,{href:"https://www.tinybird.co/docs/forward/commands/tb-secret",children:(0,r.jsx)(n.code,{children:"tb secret"})})," to manage secrets within your config."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'TYPE kafka\nKAFKA_BOOTSTRAP_SERVERS "dekaf.estuary-data.com"\nKAFKA_SECURITY_PROTOCOL SASL_SSL\nKAFKA_SASL_MECHANISM PLAIN\nKAFKA_KEY "YOUR-ORG/YOUR-PREFIX/YOUR-MATERIALIZATION"\nKAFKA_SECRET "YOUR-DEKAF-AUTH-TOKEN"\nKAFKA_SCHEMA_REGISTRY_URL "https://YOUR-ORG/YOUR-PREFIX/YOUR-MATERIALIZATION:YOUR-DEKAF-AUTH-TOKEN@dekaf.estuary-data.com"\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["While Tinybird doesn't require a schema registry URL by default, the Avro message format that Dekaf uses does require it.\nInclude the schema registry username and password (same as the Tinybird ",(0,r.jsx)(n.code,{children:"KAFKA_KEY"})," and ",(0,r.jsx)(n.code,{children:"KAFKA_SECRET"}),") within the address in the format: ",(0,r.jsx)(n.code,{children:"https://username:password@dekaf.estuary-data.com"}),"."]})}),"\n",(0,r.jsxs)(n.p,{children:["You will then need to create an associated ",(0,r.jsx)(n.code,{children:".datasource"})," file in the ",(0,r.jsx)(n.code,{children:"datasources"})," directory. The exact format will depend on your desired schema and how you want to handle ",(0,r.jsx)(n.a,{href:"#configuring-support-for-deletions",children:"deletions"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["A simple example is provided below; see ",(0,r.jsx)(n.a,{href:"https://www.tinybird.co/docs/forward/get-data-in/connectors/kafka",children:"Tinybird's docs"})," for more options and advanced configuration."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'SCHEMA >\n   `__value` String `json:#.__value`,\n   `_meta_op` String `json:$._meta.op`\n\nENGINE "MergeTree"\nENGINE_PARTITION_KEY "toYYYYMM(__timestamp)"\nENGINE_SORTING_KEY "__timestamp"\n\nKAFKA_CONNECTION_NAME "YOUR_TB_CONNECTION_FILENAME"\nKAFKA_TOPIC "YOUR_ESTUARY_TABLE_NAME"\nKAFKA_GROUP_ID "KAFKA_GROUP_ID"\nKAFKA_KEY_FORMAT "avro"\nKAFKA_VALUE_FORMAT "avro"\nKAFKA_STORE_RAW_VALUE "True"\nKAFKA_AUTO_OFFSET_RESET "earliest"\n'})}),"\n",(0,r.jsx)(n.p,{children:"Note that your topic name needs to match exactly what is set as a topic name in the binding resource config."}),"\n",(0,r.jsx)(n.p,{children:"Build and deploy your Tinybird project using:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tb build\ntb --cloud deploy\n"})}),"\n",(0,r.jsx)(n.p,{children:"You will then be able to view your Dekaf data in your Tinybird workspace."}),"\n",(0,r.jsx)(n.h3,{id:"classic-workspaces",children:"Classic workspaces"}),"\n",(0,r.jsx)(n.p,{children:"In a Tinybird Classic workspace, create a new Data Source using the Kafka Connector."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Configure Estuary Flow Data Source",src:i(584).A+"",width:"1794",height:"1305"})}),"\n",(0,r.jsx)(n.p,{children:"To configure the connection details, use the following settings."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Bootstrap servers: ",(0,r.jsx)(n.code,{children:"dekaf.estuary-data.com"})]}),"\n",(0,r.jsxs)(n.li,{children:["SASL Mechanism: ",(0,r.jsx)(n.code,{children:"PLAIN"})]}),"\n",(0,r.jsxs)(n.li,{children:["SASL Username: Your materialization's full name, such as ",(0,r.jsx)(n.code,{children:"YOUR-ORG/YOUR-PREFIX/YOUR-MATERIALIZATION"})]}),"\n",(0,r.jsx)(n.li,{children:"SASL Password: Your materialization's auth token"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:'Tick the "Decode Avro messages with Schema Registry" box, and use the following settings:'}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["URL: ",(0,r.jsx)(n.code,{children:"https://dekaf.estuary-data.com"})]}),"\n",(0,r.jsx)(n.li,{children:"Username: The same as your SASL username"}),"\n",(0,r.jsx)(n.li,{children:"Password: The same as your SASL password"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Configure Estuary Flow Schema Registry",src:i(94367).A+"",width:"1800",height:"1025"})}),"\n",(0,r.jsx)(n.p,{children:"Click Next and you will see a list of topics. These topics are the collections you added to your materialization.\nSelect the collection you want to ingest into Tinybird, and click Next."}),"\n",(0,r.jsx)(n.p,{children:"Configure your consumer group as needed."}),"\n",(0,r.jsx)(n.p,{children:"Finally, you will see a preview of the Data Source schema. Feel free to make any modifications as required, then click\nCreate Data Source."}),"\n",(0,r.jsx)(n.p,{children:"This will complete the connection with Tinybird, and new data from the Estuary Flow collection will arrive in your\nTinybird Data Source in real-time."}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.p,{children:"To use this connector, begin with data in one or more Flow collections.\nUse the below properties to configure a Dekaf materialization, which will direct one or more of your Flow collections to your desired topics."}),"\n",(0,r.jsx)(n.h3,{id:"properties",children:"Properties"}),"\n",(0,r.jsx)(n.h4,{id:"endpoint",children:"Endpoint"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Property"}),(0,r.jsx)(n.th,{children:"Title"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Required/Default"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/token"})}),(0,r.jsx)(n.td,{children:"Auth Token"}),(0,r.jsx)(n.td,{children:"The password that Kafka consumers can use to authenticate to this task."}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/strict_topic_names"})}),(0,r.jsx)(n.td,{children:"Strict Topic Names"}),(0,r.jsx)(n.td,{children:"Whether or not to expose topic names in a strictly Kafka-compliant format."}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/deletions"})}),(0,r.jsx)(n.td,{children:"Deletion Mode"}),(0,r.jsxs)(n.td,{children:["Can choose between ",(0,r.jsx)(n.code,{children:"kafka"})," or ",(0,r.jsx)(n.code,{children:"cdc"})," deletion modes."]}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"kafka"})})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"bindings",children:"Bindings"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Property"}),(0,r.jsx)(n.th,{children:"Title"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Required/Default"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/topic_name"})}),(0,r.jsx)(n.td,{children:"Topic Name"}),(0,r.jsx)(n.td,{children:"Kafka topic name that Dekaf will publish under."}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Required"})]})})]}),"\n",(0,r.jsx)(n.h3,{id:"sample",children:"Sample"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"materializations:\n  ${PREFIX}/${mat_name}:\n    endpoint:\n      dekaf:\n        config:\n          token: <auth-token>\n          strict_topic_names: false\n          deletions: kafka\n        variant: tinybird\n    bindings:\n      - resource:\n          topic_name: ${COLLECTION_NAME}\n        source: ${PREFIX}/${COLLECTION_NAME}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuring-support-for-deletions",children:"Configuring support for deletions"}),"\n",(0,r.jsxs)(n.p,{children:["Many Flow connectors capture a stream of change data which can include deletions, represented by the ",(0,r.jsxs)(n.a,{href:"/reference/deletions",children:[(0,r.jsx)(n.code,{children:"_meta/op"})," field"]}),". By default, the schema that Tinybird infers from your data won't include support for these deletions documents. The reason for this is that we frequently don't include the entire document that got deleted, and instead simply include its key. This will violate non-null constraints that get inferred at dataflow creation time."]}),"\n",(0,r.jsx)(n.p,{children:"Enabling deletions will require using the connector's CDC deletion mode."}),"\n",(0,r.jsxs)(n.p,{children:["To enable this setting in the UI, expand the ",(0,r.jsx)(n.strong,{children:"Deletion Mode"})," option in your materialization's Endpoint Config. Choose ",(0,r.jsx)(n.code,{children:"cdc"})," from the dropdown menu."]}),"\n",(0,r.jsxs)(n.p,{children:["This is expressed in the schema as the ",(0,r.jsx)(n.code,{children:"deletions"})," setting:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"endpoint:\n  dekaf:\n    config:\n      deletions: cdc\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This will change the default behavior of emitting deletions as Kafka null-value'd records to emitting the full deletion document. Documents will also contain a special ",(0,r.jsx)(n.code,{children:"/_is_deleted"})," field which is helpful for configuring hard deletes."]}),"\n",(0,r.jsx)(n.h3,{id:"soft-deletes",children:"Soft deletes"}),"\n",(0,r.jsx)(n.p,{children:"Soft deletes occur when a document is marked as deleted but is not physically removed from the destination. Instead, it is flagged for deletion with a specific metadata field."}),"\n",(0,r.jsxs)(n.p,{children:["If a row is deleted, the value of its ",(0,r.jsx)(n.code,{children:"_meta/op"})," field will be set to ",(0,r.jsx)(n.code,{children:"d"}),", distinguishing it from created (",(0,r.jsx)(n.code,{children:"c"}),") or updated (",(0,r.jsx)(n.code,{children:"u"}),") rows."]}),"\n",(0,r.jsx)(n.h3,{id:"hard-deletes",children:"Hard deletes"}),"\n",(0,r.jsx)(n.p,{children:"Instead of exposing deletion events for you to handle on your own, hard deletes cause deleted documents (identified by their unique key) to be deleted from the Tinybird dataflow entirely."}),"\n",(0,r.jsxs)(n.p,{children:["For this, you will want to make sure your Tinybird data source uses the ",(0,r.jsx)(n.code,{children:"ReplacingMergeTree"})," engine option. You can find out more about Tinybird's table engines ",(0,r.jsx)(n.a,{href:"https://www.tinybird.co/docs/sql-reference/engines",children:"here"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Ensure the ",(0,r.jsx)(n.code,{children:"cdc"})," deletion mode is enabled for your materialization. Then, you can extract the ",(0,r.jsx)(n.code,{children:"/_is_deleted"})," field, and configure the ",(0,r.jsx)(n.code,{children:"ReplacingMergeTree"})," engine's ",(0,r.jsx)(n.code,{children:"ENGINE_IS_DELETED"})," flag to use it:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'SCHEMA >\n    `__value` String `json:#.__value`,\n    `_is_deleted` UInt8 `json:$._is_deleted`,\n    `_meta_op` String `json:$._meta.op`\nENGINE "ReplacingMergeTree"\nENGINE_SORTING_KEY "__key"\nENGINE_VER "__offset"\nENGINE_IS_DELETED "_is_deleted"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Now, the last piece to the puzzle is to add the ",(0,r.jsx)(n.code,{children:"FINAL"})," keyword to any Tinybird query targeting this datasource. For example, if you create a pipe that looks like this:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Node 1"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:"SELECT * FROM your_datasource FINAL\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Node 2"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:"SELECT * FROM your_top_node WHERE _meta_op = 'd'\n"})}),"\n",(0,r.jsx)(n.p,{children:"You should find no rows returned, indicating that the deleted rows were correctly filtered out."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},94367:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/tinybird-schema-registry-setup-3c11dac3b72c2af35804bed40ffb67b5.png"}}]);