"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[8113],{19641:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>p,frontMatter:()=>c,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"concepts/flowctl","title":"flowctl","description":"There are two ways to work with Flow: through the web app, and using the flowctl command-line interface.","source":"@site/docs/concepts/flowctl.md","sourceDirName":"concepts","slug":"/concepts/flowctl","permalink":"/concepts/flowctl","draft":false,"unlisted":false,"editUrl":"https://github.com/estuary/flow/edit/master/site/docs/concepts/flowctl.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"Web application","permalink":"/concepts/web-app"},"next":{"title":"Imports","permalink":"/concepts/import"}}');var i=o(74848),s=o(28453),l=o(36573);const c={sidebar_position:7},r="flowctl",a={},d=[{value:"Installation and setup",id:"installation-and-setup",level:2},{value:"User guides",id:"user-guides",level:2},{value:"flowctl subcommands",id:"flowctl-subcommands",level:2},{value:"Editing Data Flows with flowctl",id:"editing-data-flows-with-flowctl",level:2},{value:"Reconciling specifications in local drafts",id:"reconciling-specifications-in-local-drafts",level:3},{value:"Development directories",id:"development-directories",level:2},{value:"TypeScript code generation",id:"typescript-code-generation",level:3},{value:"Protecting secrets",id:"protecting-secrets",level:2},{value:"Using <code>flowctl</code>&#39;s auto-encryption",id:"using-flowctls-auto-encryption",level:3},{value:"Controlling encryption with <code>sops</code>",id:"controlling-encryption-with-sops",level:3},{value:"Example: Protect a configuration",id:"example-protect-a-configuration",level:4},{value:"Example: Protect portions of a configuration",id:"example-protect-portions-of-a-configuration",level:4},{value:"Troubleshooting",id:"troubleshooting",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"flowctl",children:"flowctl"})}),"\n",(0,i.jsxs)(n.p,{children:["There are two ways to work with Flow: through the web app, and using the flowctl command-line interface.\nflowctl gives you more direct control over the files and directories that comprise your Data Flows.\nYou can work with any catalog to which you have ",(0,i.jsx)(n.a,{href:"/reference/authentication",children:"access"}),", regardless of whether it was created from the command line or in the web app."]}),"\n",(0,i.jsxs)(n.p,{children:["You can also authorize Flow users and roles and generate TypeScript modules to write custom transformations for your ",(0,i.jsx)(n.a,{href:"/concepts/derivations",children:"derivations"})," \u2014 workflows that aren't yet available in the web app."]}),"\n",(0,i.jsx)(n.p,{children:"flowctl is the only Flow binary that you need to work with,\nso distribution and upgrades are all simple."}),"\n",(0,i.jsx)(n.h2,{id:"installation-and-setup",children:"Installation and setup"}),"\n",(0,i.jsxs)(n.p,{children:["flowctl binaries for MacOS and Linux are available. For Windows, ",(0,i.jsx)(n.a,{href:"https://docs.estuary.dev/concepts/flowctl/",children:"install Windows Subsystem for Linux (WSL)"})," to run Linux on Windows, or use a remote development environment."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Copy and paste the appropriate script below into your terminal. This will download flowctl, make it executable, and add it to your ",(0,i.jsx)(n.code,{children:"PATH"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"For Linux:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:"sudo curl -o /usr/local/bin/flowctl -L 'https://github.com/estuary/flow/releases/latest/download/flowctl-x86_64-linux' && sudo chmod +x /usr/local/bin/flowctl\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"For Mac:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:"sudo curl -o /usr/local/bin/flowctl -L 'https://github.com/estuary/flow/releases/latest/download/flowctl-multiarch-macos' && sudo chmod +x /usr/local/bin/flowctl\n"})}),"\n",(0,i.jsx)(n.p,{children:"Alternatively, Mac users can install with Homebrew:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:"brew tap estuary/flowctl\nbrew install flowctl\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can also find the source files on GitHub ",(0,i.jsx)(n.a,{href:"https://go.estuary.dev/flowctl",children:"here"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["To connect to your Flow account and start a session, ",(0,i.jsx)(n.a,{href:"/reference/authentication#authenticating-flow-using-the-cli",children:"use an authentication token"})," from the web app."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"user-guides",children:"User guides"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/guides/flowctl/",children:"View guides for common flowctl workflows"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"flowctl-subcommands",children:"flowctl subcommands"}),"\n",(0,i.jsx)(n.p,{children:"flowctl includes several top-level subcommands representing different functional areas. Each of these include multiple nested subcommands.\nImportant top-level flowctl subcommands are described below."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"auth"})," allows you to authenticate your development session in your local development environment.\nIt's also how you provision Flow roles and users. Learn more about ",(0,i.jsx)(n.a,{href:"/reference/authentication",children:"authentication"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"catalog"})," allows you to work with your organization's current active catalog entities. You can investigate the current Data Flows,\npull specifications for local editing, test and publish specifications that you wrote or edited locally,\nand delete entities from the catalog."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"collections"})," allows you to work with your Flow collections. You can read the data from the collection and output it to stdout, or list the ",(0,i.jsx)(n.a,{href:"/concepts/advanced/journals",children:"journals"})," or journal fragments that comprise the collection. ",(0,i.jsx)(n.a,{href:"/concepts/collections#using-the-flowctl-cli",children:"Learn more about reading collections with flowctl"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"draft"})," provides an alternative method for many of the actions you'd normally perform with ",(0,i.jsx)(n.code,{children:"catalog"}),", but common workflows have more steps."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"generate"})," creates stub files and folder structures based on a provided ",(0,i.jsx)(n.code,{children:"flow.yaml"})," file. This is helpful when ",(0,i.jsx)(n.a,{href:"/guides/flowctl/create-derivation#create-a-derivation-locally",children:"creating a derivation locally"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"logs"})," allows you to review or follow logs for a particular task. This can be useful to help debug captures, derivations, and materializations."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["You can access full documentation of all flowctl subcommands from the command line by passing the ",(0,i.jsx)(n.code,{children:"--help"})," or ",(0,i.jsx)(n.code,{children:"-h"})," flag, for example:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"flowctl --help"})," lists top-level flowctl subcommands."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"flowctl catalog --help"})," lists subcommands of ",(0,i.jsx)(n.code,{children:"catalog"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"editing-data-flows-with-flowctl",children:"Editing Data Flows with flowctl"}),"\n",(0,i.jsxs)(n.p,{children:["flowctl allows you to work locally on the specification files that define your Data Flows.\nYou'll often need to move these specifications back and forth between your local environment and the ",(0,i.jsx)(n.strong,{children:"catalog"}),"\nof published entities."]}),"\n",(0,i.jsx)(n.p,{children:"The basic steps of this workflow are listed below, along with a diagram of the subcommands you'd use to accomplish them.\nKeep in mind that there's no single, correct way to work with flowctl,\nbut we recommend this method to get started."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["List all the active specifications in the catalog, which you can then pull into your local environment.\nYou can filter the output by ",(0,i.jsx)(n.a,{href:"/concepts/catalogs#namespace",children:"prefix"})," or entity type.\nFor example, ",(0,i.jsx)(n.code,{children:"flowctl catalog list --prefix acmeCo/sales/ --collections"})," only lists collections under the\n",(0,i.jsx)(n.code,{children:"acmeCo/sales/"})," prefix."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Pull a group of active specifications directly, resulting in local source files. You can refine results by prefix or entity type as described above (1)."}),"\n",(0,i.jsxs)(n.p,{children:["Note that if there are already files in your working directory, flowctl must reconcile them with the newly pulled specification.\n",(0,i.jsx)(n.a,{href:"#reconciling-specifications-in-local-drafts",children:"Learn more about your options"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Make edits locally."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Test local specifications (2)."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Publish local specifications to the catalog (3)."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(l.A,{chart:"\n\tgraph LR;\n    d[Local environment];\n    c[Active catalog];\n    d-- 2: flowctl catalog test --\x3ed;\n    d-- 3: flowctl catalog publish --\x3ec;\n    c-- 1: flowctl catalog pull-specs --\x3ed;\n"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"/guides/flowctl/edit-specification-locally",children:"View the step-by-step guide."})}),"\n",(0,i.jsx)(n.h3,{id:"reconciling-specifications-in-local-drafts",children:"Reconciling specifications in local drafts"}),"\n",(0,i.jsxs)(n.p,{children:["When you pull specifications to your working directory directly using ",(0,i.jsx)(n.code,{children:"flowctl catalog pull-specs"}),",\nthere may be conflicts between the existing files in that directory and the specifications you pull."]}),"\n",(0,i.jsxs)(n.p,{children:["By default, ",(0,i.jsx)(n.code,{children:"flowctl catalog pull-specs"})," will abort if it detects an existing file with the same name as a specification\nit is attempting to pull. You can change this behavior with the ",(0,i.jsx)(n.code,{children:"--overwrite"})," flag."]}),"\n",(0,i.jsxs)(n.p,{children:["Adding the ",(0,i.jsx)(n.code,{children:"--overwrite"})," flag will pull the new versions of conflicting files in place of the old versions."]}),"\n",(0,i.jsx)(n.h2,{id:"development-directories",children:"Development directories"}),"\n",(0,i.jsxs)(n.p,{children:["Flow specifications and other files are written to your working directory when you run ",(0,i.jsx)(n.code,{children:"flowctl draft develop"})," or ",(0,i.jsx)(n.code,{children:"flowctl catalog pull-specs"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"They typically include:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"flow.yaml"}),":\nThe main specification file that imports all other Flow specification files created in a single operation.\nAs part of local development, you may add new specifications that you create as imports."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"flow_generated/"}),":\nDirectory of generated files, including TypeScript classes and interfaces.\nSee ",(0,i.jsx)(n.a,{href:"#typescript-code-generation",children:"TypeScript code generation"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"<prefix-name>/"}),":\nDirectory of specifications that you pulled. Its name corresponds to your catalog prefix. Its contents will vary, but it may contain various YAML files and subdirectories."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"package.json"})," and ",(0,i.jsx)(n.code,{children:"package-lock.json"}),":\nFiles used by ",(0,i.jsx)(n.code,{children:"npm"})," to manage dependencies and your Data Flow's associated JavaScript project.\nYou may customize ",(0,i.jsx)(n.code,{children:"package.json"}),",\nbut its ",(0,i.jsx)(n.code,{children:"dependencies"})," stanza will be overwritten by the\n",(0,i.jsx)(n.a,{href:"/concepts/import#importing-derivation-resources",children:"npmDependencies"}),"\nof your Flow specification source files, if any exist."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["When you run commands like ",(0,i.jsx)(n.code,{children:"flowctl catalog publish"})," or ",(0,i.jsx)(n.code,{children:"flowctl draft author"}),", you can use the ",(0,i.jsx)(n.code,{children:"--source-dir"})," flag\nto push specifications from a directory other than your current working directory,\nfor example, ",(0,i.jsx)(n.code,{children:"flowctl draft author --source-dir ../AcmeCoNew/marketing"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"typescript-code-generation",children:"TypeScript code generation"}),"\n",(0,i.jsxs)(n.p,{children:["TypeScript files are used in the Flow catalog both as part of the automatic build process,\nand to define lambdas functions for ",(0,i.jsx)(n.a,{href:"/concepts/derivations",children:"derivations"}),", which requires your input."]}),"\n",(0,i.jsxs)(n.p,{children:["As part of the Data Flow build process, Flow translates your\n",(0,i.jsx)(n.a,{href:"/concepts/schemas",children:"schemas"}),"\ninto equivalent TypeScript types on your behalf.\nThese definitions live within ",(0,i.jsx)(n.code,{children:"flow_generated/"})," in your Data Flow's build directory,\nand are frequently over-written by invocations of ",(0,i.jsx)(n.code,{children:"flowctl"}),".\nFiles in this subdirectory are human-readable and stable.\nYou may want to commit them as part of a GitOps-managed project, but this isn't required."]}),"\n",(0,i.jsxs)(n.p,{children:["Whenever you define a derivation that uses a ",(0,i.jsx)(n.a,{href:"/concepts/derivations#lambdas",children:"lambda"}),",\nyou must define the lambda in an accompanying TypeScript module, and reference that module\nin the derivation's definition. To facilitate this,\nyou can generate a stub of the module using ",(0,i.jsx)(n.code,{children:"flowctl generate"}),"\nand simply write the function bodies.\n",(0,i.jsx)(n.a,{href:"/concepts/derivations#modules",children:"Learn more about this workflow."})]}),"\n",(0,i.jsxs)(n.p,{children:["If a TypeScript module exists, ",(0,i.jsx)(n.code,{children:"flowctl"})," will never overwrite it,\neven if you update or expand your specifications such that the required interfaces have changed."]}),"\n",(0,i.jsx)(n.h2,{id:"protecting-secrets",children:"Protecting secrets"}),"\n",(0,i.jsx)(n.p,{children:"Most endpoint systems require credentials of some kind,\nsuch as a username or password."}),"\n",(0,i.jsx)(n.p,{children:"Sensitive credentials should be protected while not in use.\nThe only time a credential needs to be directly accessed is when Flow initiates the connector."}),"\n",(0,i.jsxs)(n.p,{children:["Flow integrates with Mozilla\u2019s ",(0,i.jsx)(n.a,{href:"https://github.com/mozilla/sops",children:"sops"})," tool,\nwhich can encrypt and protect credentials.\nIt stores a ",(0,i.jsx)(n.code,{children:"sops"}),"-protected configuration in its encrypted form,\nand decrypts it only when invoking a connector on your behalf."]}),"\n",(0,i.jsxs)(n.p,{children:["sops, short for \u201cSecrets Operations,\u201d is a tool that encrypts the values of a JSON or YAML document\nagainst a key management system (KMS) such as Google Cloud Platform KMS, Azure Key Vault, or Hashicorp Vault.\nEncryption or decryption of a credential with ",(0,i.jsx)(n.code,{children:"sops"})," is an active process:\nit requires that the user (or the Flow runtime identity) have a current authorization to the required KMS,\nand creates a request trace which can be logged and audited.\nIt's also possible to revoke access to the KMS,\nwhich immediately and permanently removes access to the protected credential."]}),"\n",(0,i.jsxs)(n.p,{children:["When you use the Flow web application or ",(0,i.jsx)(n.code,{children:"flowctl"}),", Flow automatically\nadds ",(0,i.jsx)(n.code,{children:"sops"})," protection to sensitive fields on your behalf."]}),"\n",(0,i.jsxs)(n.p,{children:["Most workflows can make use of this built-in encryption mechanism.\nThere is also the option to configure your own encryption with ",(0,i.jsx)(n.code,{children:"sops"})," to maintain strict control over your encryption process."]}),"\n",(0,i.jsxs)(n.h3,{id:"using-flowctls-auto-encryption",children:["Using ",(0,i.jsx)(n.code,{children:"flowctl"}),"'s auto-encryption"]}),"\n",(0,i.jsxs)(n.p,{children:["Starting with version 0.5.18, ",(0,i.jsx)(n.code,{children:"flowctl"})," will automatically encrypt plain-text connector endpoint configurations when you run one of the following commands:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"draft author"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"catalog test"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"catalog publish"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"These commands use the same encryption mechanism as the dashboard and ensure that your secrets are encrypted whenever you send your specifications to Estuary."}),"\n",(0,i.jsx)(n.p,{children:"This does not, by default, encrypt secrets in your local environment.\nIf you want to encrypt local files, you can overwrite your local plain-text configuration with Estuary's encrypted version. To do so, run:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"flowctl draft author --source your/flow.yaml\nflowctl draft develop --overwrite\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This will send a draft specification to Estuary without publishing it yet.\nEstuary will encrypt the configuration as part of the ",(0,i.jsx)(n.code,{children:"draft author"})," command, and you can pull this version back to overwrite your local file."]}),"\n",(0,i.jsxs)(n.h3,{id:"controlling-encryption-with-sops",children:["Controlling encryption with ",(0,i.jsx)(n.code,{children:"sops"})]}),"\n",(0,i.jsxs)(n.p,{children:["You can also implement ",(0,i.jsx)(n.code,{children:"sops"})," manually if you are writing a Flow specification locally."]}),"\n",(0,i.jsxs)(n.p,{children:["This can be useful if you need to maintain strict control over how credentials are encrypted.\nIn this case, you own the KMS key and grant Estuary access for decryption.\n",(0,i.jsx)(n.code,{children:"flowctl"})," will not modify endpoint configurations that have already been encrypted."]}),"\n",(0,i.jsx)(n.p,{children:"The examples below provide a useful reference."}),"\n",(0,i.jsx)(n.h4,{id:"example-protect-a-configuration",children:"Example: Protect a configuration"}),"\n",(0,i.jsx)(n.p,{children:"Suppose you're given a connector configuration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="config.yaml"',children:'host: my.hostname\npassword: "this is sensitive!"\nuser: my-user\n'})}),"\n",(0,i.jsx)(n.p,{children:"You can protect it using a Google KMS key that you own:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Login to Google Cloud and initialize application default credentials used by `sops`.\n$ gcloud auth application-default login\n# Use `sops` to re-write the configuration document in place, protecting its values.\n$ sops --encrypt --in-place --gcp-kms projects/your-project-id/locations/us-central1/keyRings/your-ring/cryptoKeys/your-key-name config.yaml\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"sops"})," re-writes the file, wrapping each value in an encrypted envelope and adding a ",(0,i.jsx)(n.code,{children:"sops"})," metadata section:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="config.yaml"',children:'host: ENC[AES256_GCM,data:K/clly65pThTg2U=,iv:1bNmY8wjtjHFBcXLR1KFcsNMGVXRl5LGTdREUZIgcEU=,tag:5GKcguVPihXXDIM7HHuNnA==,type:str]\npassword: ENC[AES256_GCM,data:IDDY+fl0/gAcsH+6tjRdww+G,iv:Ye8st7zJ9wsMRMs6BoAyWlaJeNc9qeNjkkjo6BPp/tE=,tag:EPS9Unkdg4eAFICGujlTfQ==,type:str]\nuser: ENC[AES256_GCM,data:w+F7MMwQhw==,iv:amHhNCJWAJnJaGujZgjhzVzUZAeSchEpUpBau7RVeCg=,tag:62HguhnnSDqJdKdwYnj7mQ==,type:str]\nsops:\n  # Some items omitted for brevity:\n  gcp_kms:\n    - resource_id: projects/your-project-id/locations/us-central1/keyRings/your-ring/cryptoKeys/your-key-name\n      created_at: "2022-01-05T15:49:45Z"\n      enc: CiQAW8BC2GDYWrJTp3ikVGkTI2XaZc6F4p/d/PCBlczCz8BZiUISSQCnySJKIptagFkIl01uiBQp056c\n  lastmodified: "2022-01-05T15:49:45Z"\n  version: 3.7.1\n'})}),"\n",(0,i.jsxs)(n.p,{children:["You then use this ",(0,i.jsx)(n.code,{children:"config.yaml"})," within your Flow specification.\nThe Flow runtime knows that this document is protected by ",(0,i.jsx)(n.code,{children:"sops"}),"\nwill continue to store it in its protected form,\nand will attempt a decryption only when invoking a connector on your behalf."]}),"\n",(0,i.jsxs)(n.p,{children:["If you need to make further changes to your configuration,\nedit it using ",(0,i.jsx)(n.code,{children:"sops config.yaml"}),".\nIt's not required to provide the KMS key to use again,\nas ",(0,i.jsx)(n.code,{children:"sops"})," finds it within its metadata section."]}),"\n",(0,i.jsxs)(n.admonition,{type:"important",children:[(0,i.jsx)(n.p,{children:"When deploying catalogs onto the managed Flow runtime,\nyou must grant access to decrypt your GCP KMS key to the Flow runtime service agent,\nwhich is:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"flow-258@helpful-kingdom-273219.iam.gserviceaccount.com\n"})})]}),"\n",(0,i.jsx)(n.h4,{id:"example-protect-portions-of-a-configuration",children:"Example: Protect portions of a configuration"}),"\n",(0,i.jsxs)(n.p,{children:["Endpoint configurations are typically a mix of sensitive and non-sensitive values.\nIt can be cumbersome when ",(0,i.jsx)(n.code,{children:"sops"})," protects an entire configuration document as you\nlose visibility into non-sensitive values, which you might prefer to store as\ncleartext for ease of use."]}),"\n",(0,i.jsxs)(n.p,{children:["You can use the encrypted-suffix feature of ",(0,i.jsx)(n.code,{children:"sops"})," to selectively protect credentials:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="config.yaml"',children:'host: my.hostname\npassword_sops: "this is sensitive!"\nuser: my-user\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Notice that ",(0,i.jsx)(n.code,{children:"password"})," in this configuration has an added ",(0,i.jsx)(n.code,{children:"_sops"})," suffix.\nNext, encrypt only values which have that suffix:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'$ sops --encrypt --in-place --encrypted-suffix "_sops" --gcp-kms projects/your-project-id/locations/us-central1/keyRings/your-ring/cryptoKeys/your-key-name config.yaml\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"sops"}),' re-writes the file, wrapping only values having a "_sops" suffix and adding its ',(0,i.jsx)(n.code,{children:"sops"})," metadata section:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="config.yaml"',children:'host: my.hostname\npassword_sops: ENC[AES256_GCM,data:dlfidMrHfDxN//nWQTPCsjoG,iv:DHQ5dXhyOOSKI6ZIzcUM67R6DD/2MSE4LENRgOt6GPY=,tag:FNs2pTlzYlagvz7vP/YcIQ==,type:str]\nuser: my-user\nsops:\n  # Some items omitted for brevity:\n  encrypted_suffix: _sops\n  gcp_kms:\n    - resource_id: projects/your-project-id/locations/us-central1/keyRings/your-ring/cryptoKeys/your-key-name\n      created_at: "2022-01-05T16:06:36Z"\n      enc: CiQAW8BC2Au779CGdMFUjWPhNleCTAj9rL949sBvPQ6eyAC3EdESSQCnySJKD3eWX8XrtrgHqx327\n  lastmodified: "2022-01-05T16:06:37Z"\n  version: 3.7.1\n'})}),"\n",(0,i.jsxs)(n.p,{children:["You then use this ",(0,i.jsx)(n.code,{children:"config.yaml"})," within your Flow specification.\nFlow looks for and understands the ",(0,i.jsx)(n.code,{children:"encrypted_suffix"}),",\nand will remove this suffix from configuration keys before passing them to the connector."]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsxs)(n.p,{children:["If you're developing locally with ",(0,i.jsx)(n.code,{children:"flowctl"}),", watch out for these errors:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Failed to locate sops"}),": sops may not be installed correctly. See these ",(0,i.jsx)(n.a,{href:"https://github.com/getsops/sops/releases",children:"installation instructions"})," and ensure sops is on your PATH. For details on working with sops, see ",(0,i.jsx)(n.a,{href:"#protecting-secrets",children:"Protecting secrets"})," above."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Decrypting sops document failed"}),": ensure you have correctly applied a KMS key using sops to your configuration file. See above for ",(0,i.jsx)(n.a,{href:"#example-protect-a-configuration",children:"examples"}),". Note that you will not be able to decrypt credentials entered via the Flow web app."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Since updates are released regularly, make sure you're using the latest version of ",(0,i.jsx)(n.code,{children:"flowctl"}),". You can see the latest versions and changelogs on the ",(0,i.jsx)(n.a,{href:"https://github.com/estuary/flow/releases",children:"Flow releases"})," page."]}),"\n",(0,i.jsxs)(n.p,{children:["To check your current version, run: ",(0,i.jsx)(n.code,{children:"flowctl --version"})]}),"\n",(0,i.jsxs)(n.p,{children:["If you installed ",(0,i.jsx)(n.code,{children:"flowctl"})," with Homebrew, you can upgrade with: ",(0,i.jsx)(n.code,{children:"brew update && brew upgrade flowctl"})]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},36573:(e,n,o)=>{o.d(n,{A:()=>l});var t=o(96540),i=o(22279),s=o(74848);i.A.initialize({startOnLoad:!0});const l=e=>{let{chart:n}=e;return(0,t.useEffect)((()=>{i.A.contentLoaded()}),[]),(0,s.jsx)("div",{className:"mermaid",children:n})}}}]);