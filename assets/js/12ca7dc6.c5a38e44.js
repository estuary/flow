"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[3516],{28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>l});var r=t(96540);const s={},o=r.createContext(s);function i(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(o.Provider,{value:n},e.children)}},44751:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"reference/Connectors/capture-connectors/PostgreSQL/neon-postgres","title":"Neon PostgreSQL","description":"Neon\'s logical replication feature allows you to replicate data from your Neon Postgres database to external destinations.","source":"@site/docs/reference/Connectors/capture-connectors/PostgreSQL/neon-postgres.md","sourceDirName":"reference/Connectors/capture-connectors/PostgreSQL","slug":"/reference/Connectors/capture-connectors/PostgreSQL/neon-postgres","permalink":"/reference/Connectors/capture-connectors/PostgreSQL/neon-postgres","draft":false,"unlisted":false,"editUrl":"https://github.com/estuary/flow/edit/master/site/docs/reference/Connectors/capture-connectors/PostgreSQL/neon-postgres.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Google Cloud SQL for PostgreSQL","permalink":"/reference/Connectors/capture-connectors/PostgreSQL/google-cloud-sql-postgres"},"next":{"title":"PostgreSQL Batch Query Connector","permalink":"/reference/Connectors/capture-connectors/PostgreSQL/postgres-batch"}}');var s=t(74848),o=t(28453);const i={},l="Neon PostgreSQL",a={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Setup",id:"setup",level:2},{value:"1. Enable Logical Replication in Neon",id:"1-enable-logical-replication-in-neon",level:3},{value:"2. Create a Postgres Role for Replication",id:"2-create-a-postgres-role-for-replication",level:3},{value:"3. Grant Schema Access to Your Postgres Role",id:"3-grant-schema-access-to-your-postgres-role",level:3},{value:"4. Create the watermarks table, grant privileges, and create publication:",id:"4-create-the-watermarks-table-grant-privileges-and-create-publication",level:3},{value:"Allow Inbound Traffic",id:"allow-inbound-traffic",level:2},{value:"Create a Postgres Source Connector in Estuary Flow",id:"create-a-postgres-source-connector-in-estuary-flow",level:2},{value:"Backfills and performance considerations",id:"backfills-and-performance-considerations",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Properties",id:"properties",level:3},{value:"Endpoint",id:"endpoint",level:4},{value:"Bindings",id:"bindings",level:4},{value:"Sample",id:"sample",level:3},{value:"TOASTed values",id:"toasted-values",level:2},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"Publications",id:"publications",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"neon-postgresql",children:"Neon PostgreSQL"})}),"\n",(0,s.jsx)(n.p,{children:"Neon's logical replication feature allows you to replicate data from your Neon Postgres database to external destinations."}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["An ",(0,s.jsx)(n.a,{href:"https://dashboard.estuary.dev/register",children:"Estuary Flow account"})," (start free, no credit card required)"]}),"\n",(0,s.jsxs)(n.li,{children:["A ",(0,s.jsx)(n.a,{href:"https://console.neon.tech/",children:"Neon account"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,s.jsx)(n.h3,{id:"1-enable-logical-replication-in-neon",children:"1. Enable Logical Replication in Neon"}),"\n",(0,s.jsxs)(n.p,{children:["Enabling logical replication modifies the Postgres ",(0,s.jsx)(n.code,{children:"wal_level"})," configuration parameter, changing it from ",(0,s.jsx)(n.code,{children:"replica"})," to ",(0,s.jsx)(n.code,{children:"logical"})," for all databases in your Neon project. Once the ",(0,s.jsx)(n.code,{children:"wal_level"})," setting is changed to ",(0,s.jsx)(n.code,{children:"logical"}),", it cannot be reverted. Enabling logical replication also restarts all computes in your Neon project, meaning active connections will be dropped and have to reconnect."]}),"\n",(0,s.jsx)(n.p,{children:"To enable logical replication in Neon:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Select your project in the Neon Console."}),"\n",(0,s.jsxs)(n.li,{children:["On the Neon ",(0,s.jsx)(n.strong,{children:"Dashboard"}),", select ",(0,s.jsx)(n.strong,{children:"Project settings"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Select ",(0,s.jsx)(n.strong,{children:"Beta"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.strong,{children:"Enable"})," to enable logical replication."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["You can verify that logical replication is enabled by running the following query from the ",(0,s.jsx)(n.a,{href:"https://neon.tech/docs/get-started-with-neon/query-with-neon-sql-editor",children:"Neon SQL Editor"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SHOW wal_level;\n wal_level\n-----------\n logical\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-create-a-postgres-role-for-replication",children:"2. Create a Postgres Role for Replication"}),"\n",(0,s.jsxs)(n.p,{children:["It is recommended that you create a dedicated Postgres role for replicating data. The role must have the ",(0,s.jsx)(n.code,{children:"REPLICATION"})," privilege.\nThe default Postgres role created with your Neon project and roles created using the Neon Console, CLI, or API are granted membership in the neon_superuser role, which has the required ",(0,s.jsx)(n.code,{children:"REPLICATION"})," privilege."]}),"\n",(0,s.jsx)(n.p,{children:"To create a role in the Neon Console:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Navigate to the ",(0,s.jsx)(n.a,{href:"https://console.neon.tech",children:"Neon Console"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Select a project."}),"\n",(0,s.jsxs)(n.li,{children:["Select ",(0,s.jsx)(n.strong,{children:"Roles"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Select the branch where you want to create the role."}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.strong,{children:"New Role"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"In the role creation dialog, specify a role name."}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.strong,{children:"Create"}),". The role is created and you are provided with the password for the role."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Alternatively, the following CLI command creates a role. To view the CLI documentation for this command, see ",(0,s.jsx)(n.a,{href:"https://api-docs.neon.tech/reference/createprojectbranchrole",children:"Neon CLI commands \u2014 roles"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"neon roles create --name <role>\n"})}),"\n",(0,s.jsx)(n.p,{children:"As a third option, the following Neon API method also creates a role. To view the API documentation for this method, refer to the Neon API reference."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"curl 'https://console.neon.tech/api/v2/projects/hidden-cell-763301/branches/br-blue-tooth-671580/roles' \\\n  -H 'Accept: application/json' \\\n  -H \"Authorization: Bearer $NEON_API_KEY\" \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n  \"role\": {\n    \"name\": \"cdc_role\"\n  }\n}' | jq\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-grant-schema-access-to-your-postgres-role",children:"3. Grant Schema Access to Your Postgres Role"}),"\n",(0,s.jsx)(n.p,{children:"If your replication role does not own the schemas and tables you are replicating from, make sure to grant access. Run this commands for each schema:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"GRANT pg_read_all_data TO cdc_role;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"4-create-the-watermarks-table-grant-privileges-and-create-publication",children:"4. Create the watermarks table, grant privileges, and create publication:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE IF NOT EXISTS public.flow_watermarks (slot TEXT PRIMARY KEY, watermark TEXT);\nGRANT ALL PRIVILEGES ON TABLE public.flow_watermarks TO flow_capture;\nCREATE PUBLICATION flow_publication;\nALTER PUBLICATION flow_publication SET (publish_via_partition_root = true);\nALTER PUBLICATION flow_publication ADD TABLE public.flow_watermarks, <other_tables>;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"publish_via_partition_root"}),"\nsetting is recommended (because most users will want changes to a partitioned table to be captured\nunder the name of the root table) but is not required."]}),"\n",(0,s.jsxs)(n.p,{children:["Refer to the ",(0,s.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/sql-alterpublication.html",children:"Postgres docs"})," if you need to add or remove tables from your publication. Alternatively, you also can create a publication ",(0,s.jsx)(n.code,{children:"FOR ALL TABLES"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Upon start-up, the Estuary Flow connector for Postgres will automatically create the ",(0,s.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/logicaldecoding-explanation.html#LOGICALDECODING-REPLICATION-SLOTS",children:"replication slot"})," required for ingesting data change events from Postgres. The slot's name will be prefixed with ",(0,s.jsx)(n.code,{children:"estuary_"}),", followed by a unique identifier."]}),"\n",(0,s.jsxs)(n.p,{children:["To prevent storage bloat, ",(0,s.jsxs)(n.strong,{children:["Neon automatically removes ",(0,s.jsx)(n.em,{children:"inactive"})," replication slots after a period of time if there are other ",(0,s.jsx)(n.em,{children:"active"})," replication slots"]}),". If you have or intend on having more than one replication slot, please see ",(0,s.jsx)(n.a,{href:"https://docs.neon.tech/docs/logical-replication-neon#unused-replication-slots",children:"Unused replication slots"})," to learn more."]}),"\n",(0,s.jsx)(n.h2,{id:"allow-inbound-traffic",children:"Allow Inbound Traffic"}),"\n",(0,s.jsxs)(n.p,{children:["If you are using Neon's ",(0,s.jsx)(n.strong,{children:"IP Allow"})," feature to limit the IP addresses that can connect to Neon, you will need to allow inbound traffic from Estuary Flow's IP addresses.\nRefer to the ",(0,s.jsx)(n.a,{href:"/reference/allow-ip-addresses",children:"Estuary Flow documentation"})," for the list of IPs that need to be allowlisted for the Estuary Flow region of your account.\nFor information about configuring allowed IPs in Neon, see ",(0,s.jsx)(n.a,{href:"https://neon.tech/docs/introduction/ip-allow",children:"Configure IP Allow"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"create-a-postgres-source-connector-in-estuary-flow",children:"Create a Postgres Source Connector in Estuary Flow"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["In the Estuary Flow web UI, select ",(0,s.jsx)(n.strong,{children:"Sources"})," from the left navigation bar and click ",(0,s.jsx)(n.strong,{children:"New Capture"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["In the connector catalog, choose ",(0,s.jsx)(n.strong,{children:"Neon PostgreSQL"})," and click ",(0,s.jsx)(n.strong,{children:"Connect"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the connection details for your Neon database. You can get these details from your Neon connection string, which you'll find in the ",(0,s.jsx)(n.strong,{children:"Connection Details"})," widget on the ",(0,s.jsx)(n.strong,{children:"Dashboard"})," of your Neon project. Your connection string will look like this:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"postgres://cdc_role:AbC123dEf@ep-cool-darkness-123456.us-east-2.aws.neon.tech/dbname?sslmode=require\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Enter the details for ",(0,s.jsx)(n.strong,{children:"your connection string"})," into the source connector fields. Based on the sample connection string above, the values would be specified as shown below. Your values will differ."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Name: Name of the Capture connector"}),"\n",(0,s.jsx)(n.li,{children:"Server Address: ep-cool-darkness-123456.us-east-2.aws.neon.tech:5432"}),"\n",(0,s.jsx)(n.li,{children:"User: cdc_role"}),"\n",(0,s.jsxs)(n.li,{children:["Password: ",(0,s.jsx)(n.code,{children:"AbC123dEf"})," in the example, or your own value based on the connection string."]}),"\n",(0,s.jsx)(n.li,{children:"Database: dbname"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Click ",(0,s.jsx)(n.strong,{children:"Next"}),". Estuary Flow will now scan the source database for all the tables that can be replicated. Select one or more table(s) by checking the checkbox next to their name.\nOptionally, you can change the name of the destination name for each table. You can also take a look at the schema of each stream by clicking on the ",(0,s.jsx)(n.strong,{children:"Collection"})," tab."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Click ",(0,s.jsx)(n.strong,{children:"Save and Publish"})," to provision the connector and kick off the automated backfill process."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"backfills-and-performance-considerations",children:"Backfills and performance considerations"}),"\n",(0,s.jsxs)(n.p,{children:["When the PostgreSQL capture is initiated, by default, the connector first ",(0,s.jsx)(n.em,{children:"backfills"}),", or captures the targeted tables in their current state. It then transitions to capturing change events on an ongoing basis."]}),"\n",(0,s.jsx)(n.p,{children:"This is desirable in most cases, as it ensures that a complete view of your tables is captured into Flow.\nHowever, you may find it appropriate to skip the backfill, especially for extremely large tables."}),"\n",(0,s.jsxs)(n.p,{children:["In this case, you may turn off backfilling on a per-table basis. See ",(0,s.jsx)(n.a,{href:"#properties",children:"properties"})," for details."]}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["You configure connectors either in the Flow web app, or by directly editing the catalog specification file.\nSee ",(0,s.jsx)(n.a,{href:"/concepts/connectors#using-connectors",children:"connectors"})," to learn more about using connectors. The values and specification sample below provide configuration details specific to the PostgreSQL source connector."]}),"\n",(0,s.jsx)(n.h3,{id:"properties",children:"Properties"}),"\n",(0,s.jsx)(n.h4,{id:"endpoint",children:"Endpoint"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Property"}),(0,s.jsx)(n.th,{children:"Title"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Required/Default"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"/address"})})}),(0,s.jsx)(n.td,{children:"Address"}),(0,s.jsxs)(n.td,{children:["The host or host",":port"," at which the database can be reached."]}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"Required"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"/database"})})}),(0,s.jsx)(n.td,{children:"Database"}),(0,s.jsx)(n.td,{children:"Logical database name to capture from."}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsxs)(n.td,{children:["Required, ",(0,s.jsx)(n.code,{children:'"postgres"'})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"/user"})})}),(0,s.jsx)(n.td,{children:"User"}),(0,s.jsx)(n.td,{children:"The database user to authenticate as."}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsxs)(n.td,{children:["Required, ",(0,s.jsx)(n.code,{children:'"flow_capture"'})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"/password"})})}),(0,s.jsx)(n.td,{children:"Password"}),(0,s.jsx)(n.td,{children:"Password for the specified database user."}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"Required"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/advanced"})}),(0,s.jsx)(n.td,{children:"Advanced Options"}),(0,s.jsx)(n.td,{children:"Options for advanced users. You should not typically need to modify these."}),(0,s.jsx)(n.td,{children:"object"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/advanced/backfill_chunk_size"})}),(0,s.jsx)(n.td,{children:"Backfill Chunk Size"}),(0,s.jsx)(n.td,{children:"The number of rows which should be fetched from the database in a single backfill query."}),(0,s.jsx)(n.td,{children:"integer"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"4096"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/advanced/publicationName"})}),(0,s.jsx)(n.td,{children:"Publication Name"}),(0,s.jsx)(n.td,{children:"The name of the PostgreSQL publication to replicate from."}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"flow_publication"'})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/advanced/skip_backfills"})}),(0,s.jsx)(n.td,{children:"Skip Backfills"}),(0,s.jsx)(n.td,{children:"A comma-separated list of fully-qualified table names which should not be backfilled."}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/advanced/slotName"})}),(0,s.jsx)(n.td,{children:"Slot Name"}),(0,s.jsx)(n.td,{children:"The name of the PostgreSQL replication slot to replicate from."}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"flow_slot"'})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/advanced/watermarksTable"})}),(0,s.jsx)(n.td,{children:"Watermarks Table"}),(0,s.jsx)(n.td,{children:"The name of the table used for watermark writes during backfills. Must be fully-qualified in '<schema>.<table>' form."}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"public.flow_watermarks"'})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/advanced/sslmode"})}),(0,s.jsx)(n.td,{children:"SSL Mode"}),(0,s.jsx)(n.td,{children:"Overrides SSL connection behavior by setting the 'sslmode' parameter."}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"bindings",children:"Bindings"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Property"}),(0,s.jsx)(n.th,{children:"Title"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Required/Default"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"/namespace"})})}),(0,s.jsx)(n.td,{children:"Namespace"}),(0,s.jsxs)(n.td,{children:["The ",(0,s.jsx)(n.a,{href:"https://www.postgresql.org/docs/9.1/ddl-schemas.html",children:"namespace/schema"})," of the table."]}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"Required"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"/stream"})})}),(0,s.jsx)(n.td,{children:"Stream"}),(0,s.jsx)(n.td,{children:"Table name."}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"Required"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"/syncMode"})})}),(0,s.jsx)(n.td,{children:"Sync mode"}),(0,s.jsxs)(n.td,{children:["Connection method. Always set to ",(0,s.jsx)(n.code,{children:"incremental"}),"."]}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"Required"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"sample",children:"Sample"}),"\n",(0,s.jsx)(n.p,{children:"A minimal capture definition will look like the following:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'captures:\n  ${PREFIX}/${CAPTURE_NAME}:\n    endpoint:\n      connector:\n        image: "ghcr.io/estuary/source-postgres:dev"\n        config:\n          address: "localhost:5432"\n          database: "postgres"\n          user: "flow_capture"\n          password: "secret"\n    bindings:\n      - resource:\n          stream: ${TABLE_NAME}\n          namespace: ${TABLE_NAMESPACE}\n          syncMode: incremental\n        target: ${PREFIX}/${COLLECTION_NAME}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Your capture definition will likely be more complex, with additional bindings for each table in the source database."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"/concepts/captures",children:"Learn more about capture definitions."})}),"\n",(0,s.jsx)(n.h2,{id:"toasted-values",children:"TOASTed values"}),"\n",(0,s.jsxs)(n.p,{children:["PostgreSQL has a hard page size limit, usually 8 KB, for performance reasons.\nIf your tables contain values that exceed the limit, those values can't be stored directly.\nPostgreSQL uses ",(0,s.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/storage-toast.html",children:"TOAST"})," (The Oversized-Attribute Storage Technique) to\nstore them separately."]}),"\n",(0,s.jsxs)(n.p,{children:["TOASTed values can sometimes present a challenge for systems that rely on the PostgreSQL write-ahead log (WAL), like this connector.\nIf a change event occurs on a row that contains a TOASTed value, ",(0,s.jsx)(n.em,{children:"but the TOASTed value itself is unchanged"}),", it is omitted from the WAL.\nAs a result, the connector emits a row update with the value omitted, which might cause\nunexpected results in downstream catalog tasks if adjustments are not made."]}),"\n",(0,s.jsxs)(n.p,{children:["The PostgreSQL connector handles TOASTed values for you when you follow the ",(0,s.jsx)(n.a,{href:"/concepts/captures#discovery",children:"standard discovery workflow"}),"\nor use the ",(0,s.jsx)(n.a,{href:"/concepts/web-app",children:"Flow UI"})," to create your capture.\nIt uses ",(0,s.jsx)(n.a,{href:"/reference/reduction-strategies/merge",children:"merge"})," ",(0,s.jsx)(n.a,{href:"/concepts/schemas#reductions",children:"reductions"}),"\nto fill in the previous known TOASTed value in cases when that value is omitted from a row update."]}),"\n",(0,s.jsx)(n.p,{children:"However, due to the event-driven nature of certain tasks in Flow, it's still possible to see unexpected results in your data flow, specifically:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["When you materialize the captured data to another system using a connector that requires ",(0,s.jsx)(n.a,{href:"/concepts/materialization#delta-updates",children:"delta updates"})]}),"\n",(0,s.jsxs)(n.li,{children:["When you perform a ",(0,s.jsx)(n.a,{href:"/concepts/derivations",children:"derivation"})," that uses TOASTed values"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.p,{children:"If you encounter an issue that you suspect is due to TOASTed values, try the following:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Ensure your collection's schema is using the merge ",(0,s.jsx)(n.a,{href:"/concepts/schemas#reduce-annotations",children:"reduction strategy"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://www.postgresql.org/docs/9.4/sql-altertable.html",children:"Set REPLICA IDENTITY to FULL"})," for the table. This circumvents the problem by forcing the\nWAL to record all values regardless of size. However, this can have performance impacts on your database and must be carefully evaluated."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"mailto:support@estuary.dev",children:"Contact Estuary support"})," for assistance."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"publications",children:"Publications"}),"\n",(0,s.jsx)(n.p,{children:"It is recommended that the publication used by the capture only contain the tables that will be captured. In some cases it may be desirable to create this publication for all tables in the database instead of specific tables, for example using:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE PUBLICATION flow_publication FOR ALL TABLES WITH (publish_via_partition_root = true);\n"})}),"\n",(0,s.jsx)(n.p,{children:"Caution must be used if creating the publication in this way as all existing tables (even those not part of the capture) will be included in it, and if any of them do not have a primary key they will no longer be able to process updates or deletes."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);