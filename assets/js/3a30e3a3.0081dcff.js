"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[2002],{28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var s=n(96540);const a={},r=s.createContext(a);function i(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(r.Provider,{value:t},e.children)}},34969:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"guides/iam-auth/aws","title":"AWS IAM Authentication","description":"Flow supports IAM authentication with Amazon Web Services such as RDS and S3 using a role created by you which has access to the resources, and has trusted identity tokens signed by us as the OIDC (OpenID Connect) provider. Note however that not all connectors currently support using IAM authentication.","source":"@site/docs/guides/iam-auth/aws.md","sourceDirName":"guides/iam-auth","slug":"/guides/iam-auth/aws","permalink":"/guides/iam-auth/aws","draft":false,"unlisted":false,"editUrl":"https://github.com/estuary/flow/edit/master/site/docs/guides/iam-auth/aws.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Create a basic Data Flow","permalink":"/guides/create-dataflow"},"next":{"title":"Azure IAM Authentication","permalink":"/guides/iam-auth/azure"}}');var a=n(74848),r=n(28453);const i={},o="AWS IAM Authentication",d={},c=[{value:"Role with Resource Access",id:"role-with-resource-access",level:2},{value:"Identity Provider for Estuary",id:"identity-provider-for-estuary",level:2}];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"aws-iam-authentication",children:"AWS IAM Authentication"})}),"\n",(0,a.jsx)(t.p,{children:"Flow supports IAM authentication with Amazon Web Services such as RDS and S3 using a role created by you which has access to the resources, and has trusted identity tokens signed by us as the OIDC (OpenID Connect) provider. Note however that not all connectors currently support using IAM authentication."}),"\n",(0,a.jsx)(t.h2,{id:"role-with-resource-access",children:"Role with Resource Access"}),"\n",(0,a.jsxs)(t.p,{children:["In order to authenticate using AWS IAM, you need to have a role set up which has access to the resource you are trying to authenticate with. Follow the guide ",(0,a.jsx)(t.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create.html",children:"here"})," to create a role which has access to your resource and allows a maximum session of 12 hours."]}),"\n",(0,a.jsx)(t.h2,{id:"identity-provider-for-estuary",children:"Identity Provider for Estuary"}),"\n",(0,a.jsx)(t.p,{children:"Next, you need to create an IAM OIDC (OpenID Connect) provider by heading to IAM -> Identity Providers and creating a new provider with the Audience set to the ARN of the role you just created and the issuer set to one of the following values:"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"Add Identity Provider",src:n(54959).A+"",width:"2862",height:"1320"})}),"\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"Data Plane"}),(0,a.jsx)(t.th,{children:"Issuer"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"US central-1 GCP data plane"}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.a,{href:"https://openid.estuary.dev/gcp-us-central1-c2.dp.estuary-data.com/",children:"https://openid.estuary.dev/gcp-us-central1-c2.dp.estuary-data.com/"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"EU west-1 AWS data plane"}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.a,{href:"https://openid.estuary.dev/aws-eu-west-1-c1.dp.estuary-data.com/",children:"https://openid.estuary.dev/aws-eu-west-1-c1.dp.estuary-data.com/"})})]})]})]}),"\n",(0,a.jsx)(t.h1,{id:"trust-relationship-in-role",children:"Trust Relationship in Role"}),"\n",(0,a.jsxs)(t.p,{children:['Finally, in the details page of your role, head to "Trust relationships" tab and add the following trust policy, replacing the principal with one of the AWS user ARNs in the table below depending on the data plane (if you use a private deployment or BYOC, we will provide you with this value) you use and ',(0,a.jsx)(t.code,{children:":sub"})," condition with your tenant name so only tasks from your tenant are allowed to assume this role:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Effect": "Allow",\n            "Principal": {\n                "Federated": "<ARN OF IDENTITY PROVIDER>"\n            },\n            "Action": "sts:AssumeRoleWithWebIdentity",\n            "Condition": {\n                "StringEquals": {\n                    "openid.estuary.dev/gcp-us-central1-c2.dp.estuary-data.com/:aud": "<ARN OF ROLE>"\n                },\n                "StringLike": {\n                    "openid.estuary.dev/gcp-us-central1-c2.dp.estuary-data.com/:sub": "acmeCo/*"\n                }\n            }\n        }\n    ]\n}\n'})})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},54959:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/aws-iam-1-de561528608627fa3d0562023cf52c3c.png"}}]);